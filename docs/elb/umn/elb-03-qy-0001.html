<a name="elb-03-qy-0001"></a><a name="elb-03-qy-0001"></a>

<h1 class="topictitle1">Migrating from Classic Load Balancers to Shared Load Balancers</h1>
<h4 class="sectiontitle">Scenarios</h4><p id="elb-03-qy-0001__p1506549406">Classic load balancers are no longer provided. It is recommended that you use  load balancers instead because they provide comprehensive Layer 7 load balancing and better forwarding performance.</p>

<h4 class="sectiontitle">Prerequisites</h4><p id="elb-03-qy-0001__p39041252115910">You have the <strong id="elb-03-qy-0001__b1237014117476">Tenant Administrator</strong> permission.</p>

<h4 class="sectiontitle">Impacts on Traffic Routing</h4><p id="elb-03-qy-0001__p18439151924919">Traffic routing over persistent connections will be interrupted during migration and rollback. For the impact on traffic routing over short connections, see the following table.</p>

<table cellpadding="4" cellspacing="0" summary="" id="elb-03-qy-0001__table189291540135319" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Impact on traffic routing over short connections</caption><thead align="left"><tr id="elb-03-qy-0001__row593094095319"><th align="left" class="cellrowborder" valign="top" width="16%" id="mcps1.3.3.3.2.5.1.1"><p id="elb-03-qy-0001__p159301340195316">Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="24%" id="mcps1.3.3.3.2.5.1.2"><p id="elb-03-qy-0001__p13930174014536">During Migration</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="32%" id="mcps1.3.3.3.2.5.1.3"><p id="elb-03-qy-0001__p993074015316">Before Finishing Migration</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.000000000000004%" id="mcps1.3.3.3.2.5.1.4"><p id="elb-03-qy-0001__p793064065313">Rollback</p>
</th>
</tr>
</thead>
<tbody><tr id="elb-03-qy-0001__row893034018537"><td class="cellrowborder" valign="top" width="16%" headers="mcps1.3.3.3.2.5.1.1 "><p id="elb-03-qy-0001__p11930104011534">Migrating a private network load balancer</p>
</td>
<td class="cellrowborder" valign="top" width="24%" headers="mcps1.3.3.3.2.5.1.2 "><p id="elb-03-qy-0001__p129311240195311">Not interrupted</p>
</td>
<td class="cellrowborder" valign="top" width="32%" headers="mcps1.3.3.3.2.5.1.3 "><p id="elb-03-qy-0001__p2931540155314">On a client that is on the same subnet as the load balancer, run the <strong id="elb-03-qy-0001__b15145291516">arping -b</strong> <em id="elb-03-qy-0001__i1676433725">Private IP address of the classic load balancer</em> command to refresh ARP entries to ensure service continuity.</p>
<p id="elb-03-qy-0001__p1722433611409">If ARP entries are not refreshed, traffic from this client will be interrupted. The interruption duration is the ARP aging period, which ranges from 30s to 300s, depending on parameter settings of the client.</p>
<span class="notetitle"> NOTE: </span><p id="elb-03-qy-0001__p3351128104620">The private IP address of the classic load balancer is bound to the shared load balancer.</p>
</div>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.3.3.2.5.1.4 "><p id="elb-03-qy-0001__p157612623613">If ARP entries are not refreshed, traffic from the client is interrupted. The interruption duration is the ARP aging period, which ranges from 30s to 300s, depending on parameter settings of the client.</p>
<p id="elb-03-qy-0001__p1893124065313">To refresh ARP entries and shorten the interruption duration to a few seconds, run the <strong id="elb-03-qy-0001__b47991431945">arping -b</strong> <em id="elb-03-qy-0001__i118120498518">Private IP address of the classic load balancer</em> command on the client.</p>
</td>
</tr>
<tr id="elb-03-qy-0001__row2931640115319"><td class="cellrowborder" valign="top" width="16%" headers="mcps1.3.3.3.2.5.1.1 "><p id="elb-03-qy-0001__p1793117409533">Migrating a public network load balancer with the EIP changed</p>
</td>
<td class="cellrowborder" valign="top" width="24%" headers="mcps1.3.3.3.2.5.1.2 "><p id="elb-03-qy-0001__p1593124035313">Not interrupted</p>
</td>
<td class="cellrowborder" valign="top" width="32%" headers="mcps1.3.3.3.2.5.1.3 "><p id="elb-03-qy-0001__p1893164075316">Before you click <strong id="elb-03-qy-0001__b17785917172812">Finish Migration</strong>, ensure that the domain name has been mapped to the new EIP of the newly created <span id="elb-03-qy-0001__ph190314235711">shared</span> load balancer.</p>
<p id="elb-03-qy-0001__p6310114804111">If the new EIP has not been configured, traffic is still routed by the classic load balancer. After you click <strong id="elb-03-qy-0001__b158072202466">Finish Migration</strong>, traffic routing will be interrupted.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.3.3.2.5.1.4 "><p id="elb-03-qy-0001__p179312409533">Before you click <strong id="elb-03-qy-0001__b51431640203415">Roll Back</strong>, map the domain name to the EIP of the classic load balancer.</p>
<p id="elb-03-qy-0001__p198358215424">If the EIP is not configured, traffic is still routed by the <span id="elb-03-qy-0001__ph78591872585">shared</span> load balancer. After you click <strong id="elb-03-qy-0001__b12873143184613">Finish Migration</strong>, traffic routing will be interrupted.</p>
</td>
</tr>
<tr id="elb-03-qy-0001__row1293124045315"><td class="cellrowborder" valign="top" width="16%" headers="mcps1.3.3.3.2.5.1.1 "><p id="elb-03-qy-0001__p1493194016537">Migrating a public network load balancer without changing the EIP</p>
</td>
<td class="cellrowborder" valign="top" width="24%" headers="mcps1.3.3.3.2.5.1.2 "><p id="elb-03-qy-0001__p139311440165314">After the <span id="elb-03-qy-0001__ph1269783510588">shared</span> load balancer is created, traffic will be interrupted for about 5s, during which the EIP is released from the classic public network load balancer and bound to the <span id="elb-03-qy-0001__ph13765643145813">shared</span> load balancer.</p>
</td>
<td class="cellrowborder" valign="top" width="32%" headers="mcps1.3.3.3.2.5.1.3 "><p id="elb-03-qy-0001__p8931240105315">Not interrupted</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.3.3.2.5.1.4 "><p id="elb-03-qy-0001__p6931164015312">Not interrupted</p>
</td>
</tr>
</tbody>
</table>


<h4 class="sectiontitle">Migration Process</h4><p id="elb-03-qy-0001__p281955433916">The following are migration processes for three scenarios:</p>

<ul id="elb-03-qy-0001__ul2941172874017"><li id="elb-03-qy-0001__li59411028114017">Migrating a private network load balancer<span class="figcap"><b>Figure 1 </b>Migration process</span><br><span><img id="elb-03-qy-0001__image461035665614" src="en-us_image_0000001115974588.png"></span>
</li><li id="elb-03-qy-0001__li114108374410">Migrating a public network load balancer with the EIP changed<span class="figcap"><b>Figure 2 </b>Migration process</span><br><span><img id="elb-03-qy-0001__image115925713365" src="en-us_image_0000001115981688.png"></span>
</li><li id="elb-03-qy-0001__li19542042134218">Migrating a public network load balancer without changing the EIP<span class="figcap"><b>Figure 3 </b>Migration process</span><br><span><img id="elb-03-qy-0001__image106861835163617" src="en-us_image_0000001115974770.png"></span>
</li></ul>
<h4 class="sectiontitle">Migrating a Classic Load Balancer</h4><ol id="elb-03-qy-0001__ol1889111542441"><li id="elb-03-qy-0001__li104941610595">Log in to the management console.</li><li id="elb-03-qy-0001__li15494614592">In the upper left corner of the page, click <span><img id="elb-03-qy-0001__en-us_topic_0240829509_image177714713415" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="elb-03-qy-0001__li83736197297">Hover on <span><img id="elb-03-qy-0001__en-us_topic_0052569751_en-us_topic_0052569751_image616618613" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="elb-03-qy-0001__en-us_topic_0052569751_b9121102522212">Service List</strong> and choose <strong id="elb-03-qy-0001__en-us_topic_0052569751_b61222025142217">Network</strong> &gt; <strong id="elb-03-qy-0001__en-us_topic_0052569751_b4124425142210">Elastic Load Balancing</strong>.</li><li id="elb-03-qy-0001__li786163214298">In the classic load balancer list, locate the load balancer you want to migrate and choose <strong id="elb-03-qy-0001__b49398450483">More</strong> &gt; <strong id="elb-03-qy-0001__b71311750104819">Migrate</strong>.</li><li id="elb-03-qy-0001__li649416466551">Check whether the load balancer to be migrated is a private network load balancer.<ul id="elb-03-qy-0001__ul51995182116"><li id="elb-03-qy-0001__li22075142111">If it is a private network load balancer, go to <a href="#elb-03-qy-0001__li640652442318">6</a>.</li><li id="elb-03-qy-0001__li13371010192210">If it is not a private network load balancer, go to <a href="#elb-03-qy-0001__li10489153014143">7</a>.</li></ul>
</li><li id="elb-03-qy-0001__li640652442318"><a name="elb-03-qy-0001__li640652442318"></a><a name="li640652442318"></a>Run command <strong id="elb-03-qy-0001__b209351654148">arping -b</strong> <em id="elb-03-qy-0001__i12947173013282">Private IP address of the classic load balancer</em> on the client that is on the same subnet as the load balancer to update the ARP entries. Then, go to <a href="#elb-03-qy-0001__li1683144311213">11</a>.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="elb-03-qy-0001__p91305196495">The private IP address of the classic load balancer is bound to the shared load balancer. </p>
</div>
</li><li id="elb-03-qy-0001__li10489153014143"><a name="elb-03-qy-0001__li10489153014143"></a><a name="li10489153014143"></a>Determine whether you want to change the EIP.<ul id="elb-03-qy-0001__ul18223101261515"><li id="elb-03-qy-0001__li189491015151518">If you want to change the EIP, go to <a href="#elb-03-qy-0001__li15100834181518">8</a>.</li><li id="elb-03-qy-0001__li094971531516">If you do not want to change the EIP, go to <a href="#elb-03-qy-0001__li16313204716">10</a>.</li></ul>
</li><li id="elb-03-qy-0001__li15100834181518"><a name="elb-03-qy-0001__li15100834181518"></a><a name="li15100834181518"></a>Modify the DNS configuration to map the domain name to the EIP bound to the <span id="elb-03-qy-0001__ph1478815116584">shared</span> load balancer.</li><li id="elb-03-qy-0001__li1551111194188">Switch to the Cloud Eye console, view monitoring data of the classic load balancer and then go to <a href="#elb-03-qy-0001__li1683144311213">11</a>.<p id="elb-03-qy-0001__p10907920171914">If both the number of concurrent connections and the number of new connections are 0, traffic is diverted to the shared load balancer.</p>
</li><li id="elb-03-qy-0001__li16313204716"><a name="elb-03-qy-0001__li16313204716"></a><a name="li16313204716"></a>Send requests to the shared load balancer to test whether it can route requests to associated backend servers.</li><li id="elb-03-qy-0001__li1683144311213"><a name="elb-03-qy-0001__li1683144311213"></a><a name="li1683144311213"></a>Locate the classic load balancer that has been migrated and choose <strong id="elb-03-qy-0001__b1836355571510">More</strong> &gt; <strong id="elb-03-qy-0001__b88723151615">Finish Migration</strong>.<p id="elb-03-qy-0001__p2474631951">The classic load balancer will be automatically deleted.</p>
</li><li id="elb-03-qy-0001__li24042022165615">Switch to the load balancer list and view the newly created <span id="elb-03-qy-0001__ph10824156145813">shared</span> load balancer.</li></ol>

<h4 class="sectiontitle">Rolling Back to a Classic Load Balancer</h4><p id="elb-03-qy-0001__p16152102265020">If you decide to roll back, the newly created <span id="elb-03-qy-0001__ph128196035919">shared</span> load balancer will be deleted, and the original classic load balancer will be restored.</p>
<ol id="elb-03-qy-0001__ol20815325522"><li id="elb-03-qy-0001__li1627817613189">Log in to the management console.</li><li id="elb-03-qy-0001__li1927811621813">In the upper left corner of the page, click <span><img id="elb-03-qy-0001__en-us_topic_0240829509_image177714713415_1" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="elb-03-qy-0001__li17301740102218">Hover on <span><img id="elb-03-qy-0001__en-us_topic_0052569751_en-us_topic_0052569751_image616618613_1" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="elb-03-qy-0001__en-us_topic_0052569751_b9121102522212_1">Service List</strong> and choose <strong id="elb-03-qy-0001__en-us_topic_0052569751_b61222025142217_1">Network</strong> &gt; <strong id="elb-03-qy-0001__en-us_topic_0052569751_b4124425142210_1">Elastic Load Balancing</strong>.</li><li id="elb-03-qy-0001__li1481133295216">In the classic load balancer list, locate the load balancer you want to roll back and choose <strong id="elb-03-qy-0001__b281364818535">More</strong> &gt; <strong id="elb-03-qy-0001__b4814748145320">Roll Back</strong>.<p id="elb-03-qy-0001__p1277510528525">Alternatively, select the load balancer you want to roll back and click <strong id="elb-03-qy-0001__b318445195612">Roll Back</strong> above the load balancer list.</p>
</li></ol>

<h4 class="sectiontitle">Batch Migration or Rollback</h4><ol id="elb-03-qy-0001__ol536616319219"><li id="elb-03-qy-0001__li1381919199186">Log in to the management console.</li><li id="elb-03-qy-0001__li781971941812">In the upper left corner of the page, click <span><img id="elb-03-qy-0001__en-us_topic_0240829509_image177714713415_2" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="elb-03-qy-0001__li199391552112515">Hover on <span><img id="elb-03-qy-0001__en-us_topic_0052569751_en-us_topic_0052569751_image616618613_2" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="elb-03-qy-0001__en-us_topic_0052569751_b9121102522212_2">Service List</strong> and choose <strong id="elb-03-qy-0001__en-us_topic_0052569751_b61222025142217_2">Network</strong> &gt; <strong id="elb-03-qy-0001__en-us_topic_0052569751_b4124425142210_2">Elastic Load Balancing</strong>.</li><li id="elb-03-qy-0001__li1836713317219">In the classic load balancer list, select the load balancers and click <strong id="elb-03-qy-0001__b5537148105817">Migrate</strong> or <strong id="elb-03-qy-0001__b7311102515581">Roll Back</strong>.</li><li id="elb-03-qy-0001__li1020131015155">Perform subsequent operations as needed.<ul id="elb-03-qy-0001__ul026214831513"><li id="elb-03-qy-0001__li826294831514">If you choose <strong id="elb-03-qy-0001__b81871462162">Migrate</strong>, go to <a href="#elb-03-qy-0001__li1960334510517">6</a>.</li><li id="elb-03-qy-0001__li869202118166">If you choose <strong id="elb-03-qy-0001__b779763719128">Roll Back</strong>, no further operations are required.</li></ul>
</li><li id="elb-03-qy-0001__li1960334510517"><a name="elb-03-qy-0001__li1960334510517"></a><a name="li1960334510517"></a>Check whether the load balancers to be migrated are private network load balancers.<ul id="elb-03-qy-0001__ul186030451159"><li id="elb-03-qy-0001__li206039452058">If they are private network load balancers, go to <a href="#elb-03-qy-0001__li126031845051">7</a>.</li><li id="elb-03-qy-0001__li10603144514510">If they are not private network load balancers, go to <a href="#elb-03-qy-0001__li134286139103">8</a>.</li></ul>
</li><li id="elb-03-qy-0001__li126031845051"><a name="elb-03-qy-0001__li126031845051"></a><a name="li126031845051"></a>After the migration, run command <strong id="elb-03-qy-0001__b865535371715">arping -b</strong> <em id="elb-03-qy-0001__i2121194623114">Private IP address of each classic load balancer</em> on the client that is on the same subnet as the load balancer to update the ARP entries. Then, go to <a href="#elb-03-qy-0001__li16906018234">12</a>.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="elb-03-qy-0001__p1760494510519">The private IP address of the classic load balancer will be bound to the shared load balancer. </p>
</div>
</li><li id="elb-03-qy-0001__li134286139103"><a name="elb-03-qy-0001__li134286139103"></a><a name="li134286139103"></a>Determine whether you want to change the EIP.<ul id="elb-03-qy-0001__ul1942871311019"><li id="elb-03-qy-0001__li5428101351017">If you want to change the EIP, go to <a href="#elb-03-qy-0001__li2438528242">9</a>.</li><li id="elb-03-qy-0001__li15428151317105">If you do not want to change the EIP, go to <a href="#elb-03-qy-0001__li1243832192415">11</a>.</li></ul>
</li><li id="elb-03-qy-0001__li2438528242"><a name="elb-03-qy-0001__li2438528242"></a><a name="li2438528242"></a>Modify the DNS configuration to map the domain name to the EIP bound to each <span id="elb-03-qy-0001__ph175101168597">shared</span> load balancer.</li><li id="elb-03-qy-0001__li3438192112411">Switch to the Cloud Eye console, view monitoring data of each classic load balancer and then go to <a href="#elb-03-qy-0001__li16906018234">12</a>.<p id="elb-03-qy-0001__p194383272417">If both the number of concurrent connections and the number of new connections are 0, traffic is diverted to the shared load balancers.</p>
</li><li id="elb-03-qy-0001__li1243832192415"><a name="elb-03-qy-0001__li1243832192415"></a><a name="li1243832192415"></a>Send requests to shared load balancers to test whether they can route requests to associated backend servers.</li><li id="elb-03-qy-0001__li16906018234"><a name="elb-03-qy-0001__li16906018234"></a><a name="li16906018234"></a>Select all classic load balancers that have been migrated and click <strong id="elb-03-qy-0001__b144374370180">Finish Migration</strong>.<p id="elb-03-qy-0001__p147528611236">These classic load balancers will be automatically deleted.</p>
</li><li id="elb-03-qy-0001__li636713311217">Switch to the load balancer list, view the newly created <span id="elb-03-qy-0001__ph337616107593">shared</span> load balancers.</li></ol>

<h4 class="sectiontitle">Causes of Migration Failure</h4><p id="elb-03-qy-0001__p69831421589">The following are possible causes why a classic load balancer cannot be migrated:</p>

<ul id="elb-03-qy-0001__ul18244185983414"><li id="elb-03-qy-0001__li17244159183413">The quota of the <span id="elb-03-qy-0001__ph19885131812593">shared</span> load balancer, listener, backend server group, or certificate is insufficient.</li><li id="elb-03-qy-0001__li1193932763514">The classic load balancer is not in the <strong id="elb-03-qy-0001__b1556642814359">Running</strong> state.</li><li id="elb-03-qy-0001__li1553523733517">The classic load balancer listener is not in the <strong id="elb-03-qy-0001__b254043743517">Running</strong> state.</li><li id="elb-03-qy-0001__li314394443519">The <span id="elb-03-qy-0001__ph321433165917">shared</span> load balancer does not support the SSL protocol.</li></ul>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><ul id="elb-03-qy-0001__ul1423210194546"><li id="elb-03-qy-0001__li22321193543">During the migration, the listeners and backend servers of the classic load balancer are also migrated. Your applications and data will not be affected. To ensure successful migration, ensure that backend servers can be accessed from 100.125.0.0/16.</li><li id="elb-03-qy-0001__li523281912547">After the migration, the original classic load balancer will be deleted and cannot be restored, and its private IP address and EIP will be used by the newly created shared load balancer. If the classic load balancer does not have an EIP, you can bind one to the newly created shared load balancer.</li><li id="elb-03-qy-0001__li1198695120319">During batch migration of public network load balancers, ensure that the number of EIPs and the number of load balancers are the same. After the migration, the system automatically binds one EIP to each <span id="elb-03-qy-0001__ph1622424725913">shared</span> load balancer in sequence.</li><li id="elb-03-qy-0001__li172321519125414">Integration with the AS service becomes invalid after the migration. Configure AS if you want to scale the number of backend servers associated with each shared load balancer.</li><li id="elb-03-qy-0001__li192321519155412">Access logs stored in the OBS bucket are lost because shared load balancers do not support access logging.</li></ul>
</div>



<strong>Parent topic:</strong> <a href="elb_ug_qy_0002.html">Load Balancer Migration</a>



