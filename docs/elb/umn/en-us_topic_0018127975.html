<a name="en-us_topic_0018127975"></a><a name="en-us_topic_0018127975"></a>

<h1 class="topictitle1">How Do I Troubleshoot an Unhealthy Backend Server?</h1>
<h4 class="sectiontitle">Symptom</h4><p id="en-us_topic_0018127975__p956761115240">If a client cannot access a backend server through a load balancer, the backend server is declared unhealthy. You can check the health check result of the backend server on the ELB console.</p>
<ul id="en-us_topic_0018127975__ul167861954134714"><li id="en-us_topic_0018127975__li178615414713">Dedicated load balancers<p id="en-us_topic_0018127975__p0575143712564"><a name="en-us_topic_0018127975__li178615414713"></a><a name="li178615414713"></a>On the <strong id="en-us_topic_0018127975__b11504119019">Load Balancers</strong> page, click the name of the load balancer to view its details. Click <strong id="en-us_topic_0018127975__b171621111502">Backend Server Groups</strong> and locate the server group. In the <strong id="en-us_topic_0018127975__b14163171112019">Basic Information</strong> area, view the health check result of the backend server.</p>
</li></ul>
<ul id="en-us_topic_0018127975__ul654511504309"><li id="en-us_topic_0018127975__li1044984322517"><span id="en-us_topic_0018127975__ph15170164618279">Shared</span> load balancers<p id="en-us_topic_0018127975__p3414151710266">On the <strong id="en-us_topic_0018127975__b2004531380">Load Balancers</strong> page, click the name of the load balancer to view its details. Click <strong id="en-us_topic_0018127975__b82334685">Backend Server Groups</strong> and locate the server group. In the <strong id="en-us_topic_0018127975__b861389241">Basic Information</strong> area, view the health check result of the backend server.</p>
</li></ul>

<h4 class="sectiontitle">Background</h4><p id="en-us_topic_0018127975__p43631013174">The load balancer uses IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph1820812303110"></span> to send heartbeats to backend <span id="en-us_topic_0018127975__ph164298411181">server</span>s and check their health. To ensure that health checks can be performed normally, IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph1267819351083"></span> must be allowed to access the backend <span id="en-us_topic_0018127975__ph05881731534">server</span>s.</p>
<span class="cautiontitle"><img src="public_sys-resources/caution_3.0-en-us.png"> </span><p id="en-us_topic_0018127975__p10385101122115">Security group rules configured for backend servers associated with dedicated load balancers are different from those configured for backend servers associated with shared load balancers.</p>
<ul id="en-us_topic_0018127975__ul497173612218"><li id="en-us_topic_0018127975__li397193642217">Classic and shared load balancers: Ensure that security group rules allow access from IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph59168118235"></span>.</li><li id="en-us_topic_0018127975__li14181165142319">Dedicated load balancers: Ensure that security group rules allow access from IP addresses in the CIDR block of the VPC where the backend server resides.<p id="en-us_topic_0018127975__p14669173993815"><a name="en-us_topic_0018127975__li14181165142319"></a><a name="li14181165142319"></a>For details about how to configure security groups for backend servers associated with dedicated load balancers, see <a href="elb_ug_hd_0007.html">Configuring Security Group Rules for Backend Servers (Dedicated Load Balancers)</a>.</p>
</li></ul>
</div>
<p id="en-us_topic_0018127975__p1048001016193">If a backend server is considered unhealthy, ELB will not route traffic to it until it is declared healthy again.</p>
<p id="en-us_topic_0018127975__p368592515290">If you change the weight of a healthy backend server to 0, the health check result of this server becomes <strong id="en-us_topic_0018127975__b0349182105411">Unhealthy</strong>.</p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><ul id="en-us_topic_0018127975__ul19429418247"><li id="en-us_topic_0018127975__li11426417242">When a backend <span id="en-us_topic_0018127975__ph18934914163411">server</span> is detected as unhealthy, the load balancer will stop routing requests to this <span id="en-us_topic_0018127975__ph534816569720">server</span>. </li><li id="en-us_topic_0018127975__li942124115245">If health checks are disabled, the load balancer will consider the backend <span id="en-us_topic_0018127975__ph1634013083417">server</span> healthy by default and still route requests to it.</li><li id="en-us_topic_0018127975__li16421341162419">ELB uses IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph18282121024510"></span> to perform health checks and route requests to backend servers.</li><li id="en-us_topic_0018127975__li19680165916404">If the <strong id="en-us_topic_0018127975__b1644342511201">Obtain Client IP Address</strong> option is enabled for TCP and UDP listeners of both dedicated and shared load balancers, client IP addresses instead of the IP addresses in 100.125.0.0/16 are used to communicate with the backend server.</li><li id="en-us_topic_0018127975__li1093636103119">Traffic is not routed to a backend <span id="en-us_topic_0018127975__ph134821218455">server</span> with a weight of 0, and the health check result for the backend server is not relevant.</li></ul>
</div>

<h4 class="sectiontitle">Troubleshooting Procedure</h4><p id="en-us_topic_0018127975__p17987205213470">Possible causes are sequenced based on their occurrence probability.</p>
<p id="en-us_topic_0018127975__p997211345215">Check these causes one by one until the fault persists.</p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_topic_0018127975__p2213101212216">You may need to change the health check configuration. It takes a while for the modification to take effect. The required time depends on health check interval and timeout duration. View the health check result in the backend server list of the load balancer.</p>
</div>
<span class="figcap"><b>Figure 1 </b>Troubleshooting process</span><br><span><img id="en-us_topic_0018127975__image17542317161020" src="en-us_image_0000001161784976.png"></span>

<table cellpadding="4" cellspacing="0" summary="" id="en-us_topic_0018127975__table11639162722113" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Troubleshooting process</caption><thead align="left"><tr id="en-us_topic_0018127975__row563912711214"><th align="left" class="cellrowborder" valign="top" width="31.290000000000003%" id="mcps1.3.3.6.2.3.1.1"><p id="en-us_topic_0018127975__p17639192710215">Possible Cause</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="68.71000000000001%" id="mcps1.3.3.6.2.3.1.2"><p id="en-us_topic_0018127975__p1063918274214">Solution</p>
</th>
</tr>
</thead>
<tbody><tr id="en-us_topic_0018127975__row4357714105419"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p133581514165416">Backend server group</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p33589149549"><a href="#en-us_topic_0018127975__section190812168556">Checking Whether the Backend Server Group Is Associated with a Listener</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row1163911274215"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p1663915273217">Health check configuration</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p126399272210"><a href="#en-us_topic_0018127975__section10449191315558">Checking the Health Check Configuration</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row76394277211"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p3878136959">Security group rules</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p04101151582"><a href="#en-us_topic_0018127975__section2948957185917">Checking Security Group Rules</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row1063915276211"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p1540217018517">Network ACL rules</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p193622023185"><a href="#en-us_topic_0018127975__section125775401003">Checking Firewall Rules</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row13639142722110"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p134023012513">Backend server listening configuration</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p121925431186"><a href="#en-us_topic_0018127975__section12988243125410">Checking the Backend Server</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row19639327182118"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p114407135615">Backend server firewall configuration</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p79891041290"><a href="#en-us_topic_0018127975__section250265525">Checking the Firewall on the Backend Server</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row13916441766"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p1918192715613">Backend server route configuration</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p10820922798"><a href="#en-us_topic_0018127975__section25361331629">Checking the Backend Server Route</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row11917648618"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p76369345618">Backend server load</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p1669012421699"><a href="#en-us_topic_0018127975__section1047211561921">Checking the Backend Server Load</a></p>
</td>
</tr>
<tr id="en-us_topic_0018127975__row139174410614"><td class="cellrowborder" valign="top" width="31.290000000000003%" headers="mcps1.3.3.6.2.3.1.1 "><p id="en-us_topic_0018127975__p7704184019614">Backend server <strong id="en-us_topic_0018127975__b997412223198">host.deny</strong> file</p>
</td>
<td class="cellrowborder" valign="top" width="68.71000000000001%" headers="mcps1.3.3.6.2.3.1.2 "><p id="en-us_topic_0018127975__p520713141013"><a href="#en-us_topic_0018127975__section18101222533">Checking the host.deny File</a></p>
</td>
</tr>
</tbody>
</table>


<a name="en-us_topic_0018127975__section190812168556"></a><a name="section190812168556"></a><h4 class="sectiontitle">Checking Whether the Backend Server Group Is Associated with a Listener</h4><p id="en-us_topic_0018127975__p18813244145">Check whether the backend server group that the unhealthy backend server belongs to is associated with a listener.</p>
<ul id="en-us_topic_0018127975__ul999744013557"><li id="en-us_topic_0018127975__li14517349103119">If the backend server group is not associated with a listener, check whether a listener has been added to the load balancer.<ul id="en-us_topic_0018127975__ul642613416368"><li id="en-us_topic_0018127975__li1542653403611">If a listener has been added. Associate the backend server group with the listener.</li><li id="en-us_topic_0018127975__li12919467368">If no listeners exist. Add a listener. Select <strong id="en-us_topic_0018127975__b1450111615309">Use existing</strong> and then select the backend server group when you add the listener.</li></ul>
</li><li id="en-us_topic_0018127975__li43263415308">If the backend server group has been associated with a listener, proceed with the following operations.</li></ul>

<a name="en-us_topic_0018127975__section10449191315558"></a><a name="section10449191315558"></a><h4 class="sectiontitle">Checking the Health Check Configuration</h4><p id="en-us_topic_0018127975__p245018135555"><strong id="en-us_topic_0018127975__b1458641823211">Classic load balancers</strong>: In the <strong id="en-us_topic_0018127975__b1921431132516">Listeners</strong> area, locate the listener with an unhealthy backend server associated and click <strong id="en-us_topic_0018127975__b1631193182518">View</strong> in the <strong id="en-us_topic_0018127975__b132131132510">Health Check</strong> column. The <strong id="en-us_topic_0018127975__b0291822142119">Health Check</strong> dialog box is displayed. Check the following parameters:</p>
<ul id="en-us_topic_0018127975__ul1953191532110"><li id="en-us_topic_0018127975__li1370583213225">Health check protocol and port<p id="en-us_topic_0018127975__p652654364317"><a name="en-us_topic_0018127975__li1370583213225"></a><a name="li1370583213225"></a>The health check port must be the one used on the backend server, and it cannot be customized.</p>
<p id="en-us_topic_0018127975__p157585385223">Check whether the health check port is the one that the load balancer is listening to. If the two ports are inconsistent, the health check will become abnormal.</p>
</li><li id="en-us_topic_0018127975__li1845021395510"><strong id="en-us_topic_0018127975__b5738155532320">Check Path</strong>. If HTTP is used for health checks, you must check this parameter. A simple static HTML file is recommended.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_topic_0018127975__p19499180115813">Enter an absolute path.</p>
<p id="en-us_topic_0018127975__p175917101539">Examples:</p>
<p id="en-us_topic_0018127975__p1052715212216">If the URL is <strong id="en-us_topic_0018127975__b3491144222211">http://www.example.com/chat/try/</strong>, the health check path is <strong id="en-us_topic_0018127975__b8504104213228">/chat/try/</strong>.</p>
<p id="en-us_topic_0018127975__p149119272316">If the URL is <strong id="en-us_topic_0018127975__b6888155914333">http://192.168.63.187:9096/chat/index.html</strong>, the health check path is <strong id="en-us_topic_0018127975__b158825519345">/chat/index.html</strong>.</p>
</div>
<p id="en-us_topic_0018127975__p15926953133711"></p>
</li></ul>
<p id="en-us_topic_0018127975__p5450913175518"><strong id="en-us_topic_0018127975__b1618863273216"><span id="en-us_topic_0018127975__ph3976173615256">Shared</span> load balancers</strong>: Click the name of the load balancer to view its details. Click <strong id="en-us_topic_0018127975__b998553992513">Backend Server Groups</strong> and then click the name of the server group. On the <strong id="en-us_topic_0018127975__b1698610393255">Basic Information</strong> page, click <strong id="en-us_topic_0018127975__b398617394252">Configure</strong> on the right of <strong id="en-us_topic_0018127975__b498723992512">Health Check</strong>. Check the following parameters:</p>
<ul id="en-us_topic_0018127975__ul174507131556"><li id="en-us_topic_0018127975__li1845041375511"><strong id="en-us_topic_0018127975__b1068611388251">Protocol</strong></li><li id="en-us_topic_0018127975__li1745061325516"><strong id="en-us_topic_0018127975__b12267154482515">Port</strong> The port must be the one used on the backend server, and it cannot be customized. Check whether the health check port is the one that the load balancer is listening to. If the two ports are inconsistent, the health check will become abnormal.</li><li id="en-us_topic_0018127975__li114504135556"><strong id="en-us_topic_0018127975__b11657150112611">Check Path</strong> If HTTP is used for health checks, you must check this parameter. A simple static HTML file is recommended.</li></ul>

<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><ul id="en-us_topic_0018127975__ul17862515174013"><li id="en-us_topic_0018127975__li48621915184011">If the health check protocol is HTTP, the port and the path are used for health checks.</li><li id="en-us_topic_0018127975__li1030810382401">If the health check protocol is TCP, only the port is used for health checks.</li><li id="en-us_topic_0018127975__li1893641784111">If health check protocol is HTTP and the health check port is normal, change the path or change the health check protocol to TCP.</li><li id="en-us_topic_0018127975__li131244162619">Enter an absolute path.<p id="en-us_topic_0018127975__p543012419614"><a name="en-us_topic_0018127975__li131244162619"></a><a name="li131244162619"></a>Examples:</p>
<p id="en-us_topic_0018127975__p1343017411767">If the URL is <strong id="en-us_topic_0018127975__b176351252163816">http://www.example.com/chat/try/</strong>, the health check path is <strong id="en-us_topic_0018127975__b1364720526381">/chat/try/</strong>.</p>
<p id="en-us_topic_0018127975__p134302415611">If the URL is <strong id="en-us_topic_0018127975__b879155693810">http://192.168.63.187:9096/chat/index.html</strong>, the health check path is <strong id="en-us_topic_0018127975__b079195617381">/chat/index.html</strong>.</p>
</li></ul>
</div>

<a name="en-us_topic_0018127975__section2948957185917"></a><a name="section2948957185917"></a><h4 class="sectiontitle">Checking Security Group Rules</h4><ul id="en-us_topic_0018127975__ul3162105921417"><li id="en-us_topic_0018127975__li111621159191410"><strong id="en-us_topic_0018127975__b52710134012">Dedicated Load balancers</strong><p id="en-us_topic_0018127975__p2125183817237">The inbound rules of the security group that the backend server belongs to must allow traffic to the VPC where the load balancer resides.</p>
</li><li id="en-us_topic_0018127975__li7162115913142"><strong id="en-us_topic_0018127975__b348510222258"><span id="en-us_topic_0018127975__ph148331249124017">Shared</span>ELB</strong><ul id="en-us_topic_0018127975__ul17602183020223"><li id="en-us_topic_0018127975__li19514114532216"><strong id="en-us_topic_0018127975__b16942572810">TCP, HTTP, or HTTPS listeners</strong>: Verify that the inbound rule of the security group containing the backend server allows access from 100.125.0.0/16<span id="en-us_topic_0018127975__ph11107105172815"></span> and allows the traffic from the health check port.<ul id="en-us_topic_0018127975__ul145145450224"><li id="en-us_topic_0018127975__li125141145132212">If the health check port is the same as the backend port, the inbound rule must allow traffic from the backend port, for example, 80.</li><li id="en-us_topic_0018127975__li051415453229">If the health check port is different from the backend port, the inbound rule must allow traffic from both the health check port and backend port, for example, 443 and 80.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_topic_0018127975__p11515104532216">You can check the protocol and port in the basic information area of the backend server group.</p>
</div>
</li></ul>
<span class="figcap"><b>Figure 2 </b>Example inbound rule</span><br><span><img id="en-us_topic_0018127975__image3515134542216" src="en-us_image_0000001150291788.png"></span>
</li><li id="en-us_topic_0018127975__li189521229142315"><strong id="en-us_topic_0018127975__b4695413512">UDP listeners</strong>: Verify that the inbound rule of the security group allows traffic from the health check protocol, health check port, and 100.125.0.0/16<span id="en-us_topic_0018127975__ph137185418819"></span>. In addition, the ICMP traffic must be allowed in the inbound direction.<span class="figcap"><b>Figure 3 </b>Example inbound rule that allows ICMP traffic</span><br><span><img id="en-us_topic_0018127975__image1995322972314" src="en-us_image_0000001196171669.png"></span>
</li></ul>
</li><li id="en-us_topic_0018127975__li616265971419"><strong id="en-us_topic_0018127975__b58148263281">Classic load balancers on a private network</strong>: Verify that the TCP traffic is allowed over the health check port in the VPC.<span class="figcap"><b>Figure 4 </b>Example inbound rule that allows TCP traffic within the VPC</span><br><span><img id="en-us_topic_0018127975__image526172119219" src="en-us_image_0000001150131972.png"></span>
</li></ul>
<ul id="en-us_topic_0018127975__ul133014318815"><li id="en-us_topic_0018127975__li12744150496"><strong id="en-us_topic_0018127975__b141271194517">TCP, HTTP, or HTTPS listeners</strong>: Verify that the inbound rule of the security group containing the backend server allows access from 100.125.0.0/16<span id="en-us_topic_0018127975__ph168391050886"></span> and allows the traffic from the health check port.<ul id="en-us_topic_0018127975__ul016271195110"><li id="en-us_topic_0018127975__li216211185118">If the health check port is the same as the backend port, the inbound rule must allow traffic from the backend port, for example, 80.</li><li id="en-us_topic_0018127975__li1616201105110">If the health check port is different from the backend port, the inbound rule must allow traffic from both the health check port and backend port, for example, 443 and 80.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_topic_0018127975__p3551155116447">You can check the protocol and port in the basic information area of the backend server group.</p>
</div>
</li></ul>
<span class="figcap"><b>Figure 5 </b>Example inbound rule</span><br><span><img id="en-us_topic_0018127975__image4134162144610" src="en-us_image_0291936910.png"></span>
</li><li id="en-us_topic_0018127975__li2041611334815"><strong id="en-us_topic_0018127975__b2132719696">UDP listeners</strong>: Verify that the inbound rule of the security group allows traffic from the health check protocol, health check port, and 100.125.0.0/16<span id="en-us_topic_0018127975__ph2004090260"></span>. In addition, the ICMP traffic must be allowed in the inbound direction.<span class="figcap"><b>Figure 6 </b>Example inbound rule that allows ICMP traffic</span><br><span><img id="en-us_topic_0018127975__image3383353134614" src="en-us_image_0291937212.png"></span>
</li><li id="en-us_topic_0018127975__li915453123814"><strong id="en-us_topic_0018127975__b1695848349">Classic load balancers on a private network</strong>: Verify that the TCP traffic is allowed over the health check port in the VPC.<span class="figcap"><b>Figure 7 </b>Example inbound rule that allows TCP traffic within the VPC</span><br><span><img id="en-us_topic_0018127975__image951917588475" src="en-us_image_0291937584.png"></span>
</li></ul>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><ul id="en-us_topic_0018127975__ul8116131384110"><li id="en-us_topic_0018127975__li12116191374117">Access to the backend server from IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph1745643117218"></span> must be allowed. Load balancers communicate with backend servers using these IP addresses. After traffic is routed to backend servers, source IP addresses are converted to IP addresses starting with 100.125. In addition, the IP address of the health check node is allocated from 100.125.0.0/16<span id="en-us_topic_0018127975__ph195418598816"></span>.</li><li id="en-us_topic_0018127975__li611619137413">If you are not sure about the security group rules, change the protocol and port range to <strong id="en-us_topic_0018127975__b1971713582191">All</strong> just for testing purposes.</li><li id="en-us_topic_0018127975__li13395855114811">For UDP listeners, see <a href="elb_faq_0024.html">How Does ELB Perform UDP Health Checks? What Are the Precautions for UDP Health Checks?</a></li></ul>
</div>

<a name="en-us_topic_0018127975__section125775401003"></a><a name="section125775401003"></a><h4 class="sectiontitle">Checking Firewall Rules</h4><p id="en-us_topic_0018127975__p171397513716">You can associate one or more subnets with a firewall for controlling traffic in and out of the subnets. Similar to security groups, firewalls provide access control functions, but add an additional layer of defense to your VPC. Default firewall rules reject all inbound and outbound traffic. If the subnet of a load balancer or associated backend servers has a firewall associated, the load balancer cannot receive traffic from the Internet or route traffic to backend servers, and backend servers cannot receive traffic from and respond to the load balancer.</p>
<p id="en-us_topic_0018127975__p6625133892">You can configure an inbound firewall rule to permit access from 100.125.0.0/16<span id="en-us_topic_0018127975__elb_ug_hd_0002_ph762162974312"></span>.</p>
<ol id="en-us_topic_0018127975__ol14819194213910"><li id="en-us_topic_0018127975__elb_ug_hd_0002_li20860192818532">Log in to the management console.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li1486022812537">In the upper left corner of the page, click <span><img id="en-us_topic_0018127975__elb_ug_hd_0002_en-us_topic_0240829509_image177714713415" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_l2446029456ed45d08632be6e309b1c82">Under <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b1786225315520">Network</strong>, click <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b9112421133718">Virtual Private Cloud</strong>.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li47160469161557">In the navigation pane on the left, choose <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b132711555103617">Access Control</strong> &gt; <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b1827355511364">Firewalls</strong>.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li30045754154757">Locate the firewall, and click the firewall name to switch to the firewall details page.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li1976338154757">On the <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b16992330173711">Inbound Rules</strong> or <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b1499353014377">Outbound Rules</strong> tab page, click <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b7993030143715">Add Rule</strong> to add a rule.<ul id="en-us_topic_0018127975__elb_ug_hd_0002_ul185172012178"><li id="en-us_topic_0018127975__elb_ug_hd_0002_li4511820191719"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b103837331378">Action</strong>: Select <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b11383173311379">Allow</strong>.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li8626942141716"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b319013893714">Protocol</strong>: The protocol must be the same as the frontend protocol you select when you add the listener.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li9500202313188"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b183643993714">Source</strong>: Set the value to <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b4837239203719">100.125.0.0/16<span id="en-us_topic_0018127975__elb_ug_hd_0002_ph48650374431"></span></strong>.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li66251610162417"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b27061041103719">Source Port Range</strong>: Select the port range.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li7464162916350"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b7201144183717">Destination</strong>: Enter the default value <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b164094559370">0.0.0.0/0</strong>. Traffic will be destined for all IP addresses.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li5915133319341"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b0931145823718">Destination Port Range</strong>: Select the port range.</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li75457153520"><strong id="en-us_topic_0018127975__elb_ug_hd_0002_b1455819389">Description</strong>: Enter a description for the firewall rule if necessary.</li></ul>
</li><li id="en-us_topic_0018127975__elb_ug_hd_0002_li162953310168">Click <strong id="en-us_topic_0018127975__elb_ug_hd_0002_b17342202183812">OK</strong>.</li></ol>

<a name="en-us_topic_0018127975__section12988243125410"></a><a name="section12988243125410"></a><h4 class="sectiontitle">Checking the Backend Server</h4><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_topic_0018127975__p169881143185415">If the backend <span id="en-us_topic_0018127975__ph119838292097">server</span> runs a Windows OS, use a browser to access <strong id="en-us_topic_0018127975__b8293112312294">https://</strong><em id="en-us_topic_0018127975__i8293423142914">Backend server IP address</em>:<em id="en-us_topic_0018127975__i729482352920">Health check port</em>. If a 2xx or 3xx code is returned, the backend server is running normally.</p>
</div>
<ul id="en-us_topic_0018127975__ul79881143175413"><li id="en-us_topic_0018127975__li7988184315541">Run the following command on the backend server to check whether the health check port is listened on:<pre class="screen" id="en-us_topic_0018127975__screen119881543135418">netstat -anlp | grep port</pre>
<p id="en-us_topic_0018127975__p1167252912918">If the health check port and <strong id="en-us_topic_0018127975__b44118548150">LISTEN</strong> are displayed, the backend port is in the listening state. As shown in <a href="#en-us_topic_0018127975__fig1698814434541">Figure 8</a>, TCP port 880 is listened on.</p>
If you do not specify a health check port, backend ports are used by default.<a name="en-us_topic_0018127975__fig1698814434541"></a><a name="fig1698814434541"></a><span class="figcap"><b>Figure 8 </b>Backend server port listened on</span><br><span><img id="en-us_topic_0018127975__image149891434540" src="en-us_image_0277560434.png"></span>

<span class="figcap"><b>Figure 9 </b>Backend server port not listened on</span><br><span><img id="en-us_topic_0018127975__image69899431540" src="en-us_image_0277560435.png"></span>
</li><li id="en-us_topic_0018127975__li189891543185419">For HTTP health checks, run the following command on the backend <span id="en-us_topic_0018127975__ph1288314115105">server</span> to check the status code:<pre class="screen" id="en-us_topic_0018127975__screen15989843125414">curl <em id="en-us_topic_0018127975__i105301339191716">Private IP address of the backend <span id="en-us_topic_0018127975__ph578711155106">server</span>:Health check port/Health check path</em> -iv</pre>
<p id="en-us_topic_0018127975__p298954318547">To perform an HTTP health check, the load balancer initiates a GET request to the backend <span id="en-us_topic_0018127975__ph882916219109">server</span>. If the following response status codes are displayed, the backend <span id="en-us_topic_0018127975__ph1684216823217">server</span> is considered healthy:</p>
<p id="en-us_topic_0018127975__p298911433547">TCP listeners: 200</p>
<p id="en-us_topic_0018127975__p2989104318546">Public network classic load balancers: 2xx or 3xx</p>
<p id="en-us_topic_0018127975__p13252631125215">Dedicated load balancers: 200 for TCP/UDP/HTTP/HTTPS health checks</p>
<p id="en-us_topic_0018127975__p194129469501"><span id="en-us_topic_0018127975__ph641216466507">Shared</span> load balancers: 200, 202, or 401 for HTTP health checks, and 200 for TCP health checks</p>
<span class="figcap"><b>Figure 10 </b>Unhealthy backend server</span><br><span><img id="en-us_topic_0018127975__image1098915432547" src="en-us_image_0277560436.png"></span>
<span class="figcap"><b>Figure 11 </b>Healthy backend server</span><br><span><img id="en-us_topic_0018127975__image1098914312541" src="en-us_image_0277560437.png"></span>
</li><li id="en-us_topic_0018127975__li149891434540">If HTTP is used for health checks and the backend server is detected unhealthy, perform the following steps to configure a TCP health check:<p id="en-us_topic_0018127975__p5989154315415"><a name="en-us_topic_0018127975__li149891434540"></a><a name="li149891434540"></a>On the <strong id="en-us_topic_0018127975__b957961317158">Listeners</strong> tab page, modify the listener, select the backend <span id="en-us_topic_0018127975__ph32521240141012">server</span> group for which TCP health check has been configured, or add a backend <span id="en-us_topic_0018127975__ph196275326362">server</span> group and select TCP as the health check protocol. After you complete the configuration, wait for a while and check the health check result.</p>
</li></ul>

<a name="en-us_topic_0018127975__section250265525"></a><a name="section250265525"></a><h4 class="sectiontitle">Checking the Firewall on the Backend Server</h4><p id="en-us_topic_0018127975__p310816281223">The firewall or other security software on the backend <span id="en-us_topic_0018127975__ph126805041115">server</span> may mask IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph16822123011012"></span>. Ensure that access from 100.125.0.0/16<span id="en-us_topic_0018127975__ph432483361018"></span> is allowed in the security group containing the backend <span id="en-us_topic_0018127975__ph1357117613712">server</span>.</p>

<a name="en-us_topic_0018127975__section25361331629"></a><a name="section25361331629"></a><h4 class="sectiontitle">Checking the Backend Server Route</h4><p id="en-us_topic_0018127975__p132046430258">Check whether the default route configured for the primary NIC has been manually modified. If the default route is changed, health check packets may fail to reach the backend server.</p>
Run the following command on the backend server to check whether the default route points to the gateway (For Layer 3 communications, the default route must be configured to point to the gateway):<pre class="screen" id="en-us_topic_0018127975__screen1493516521871">ip route</pre>

<p id="en-us_topic_0018127975__p12669154312129">Alternatively, run the following command:</p>
<pre class="screen" id="en-us_topic_0018127975__screen1474719475122">route -n</pre>
<p id="en-us_topic_0018127975__p156025469713">If the command output does not contain the highlighted route or the IP address to which the route points is not the gateway address of the VPC subnet, change the route to the default one.</p>
<span class="figcap"><b>Figure 12 </b>Example default route pointing to the gateway</span><br><span><img id="en-us_topic_0018127975__image14124389918" src="en-us_image_0171437555.png"></span>
<span class="figcap"><b>Figure 13 </b>Example default route not pointing to the gateway</span><br><span><img id="en-us_topic_0018127975__image12391427175817" src="en-us_image_0171437556.png"></span>

<a name="en-us_topic_0018127975__section1047211561921"></a><a name="section1047211561921"></a><h4 class="sectiontitle">Checking the Backend Server Load</h4><p id="en-us_topic_0018127975__p18313191418319">Check the load of the backend <span id="en-us_topic_0018127975__ph1053504813118">server</span>. If the load is high, connections or requests for health checks may time out.</p>

<a name="en-us_topic_0018127975__section18101222533"></a><a name="section18101222533"></a><h4 class="sectiontitle">Checking the <strong id="en-us_topic_0018127975__b641281211232">host.deny</strong> File</h4><p id="en-us_topic_0018127975__p1251505315">Verify that IP addresses in 100.125.0.0/16<span id="en-us_topic_0018127975__ph4690164217109"></span> are not written to the <strong id="en-us_topic_0018127975__b975552194812">/etc/hosts.deny</strong> file on the backend <span id="en-us_topic_0018127975__ph58566891212">server</span>.</p>




<strong>Parent topic:</strong> <a href="elb_faq_0204.html">Health Check</a>



