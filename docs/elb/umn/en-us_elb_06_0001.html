<a name="en-us_elb_06_0001"></a><a name="en-us_elb_06_0001"></a>

<h1 class="topictitle1">Configuring the TOA Plug-in</h1>
<h4 class="sectiontitle">Scenarios</h4><p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p46969777103741">ELB provides customized strategies for managing service access. Before customizing these strategies, ELB needs to obtain the client's IP address contained in the access request. To obtain the IP addresses, you can install a TOA kernel module on backend servers.</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p4735908815146">This section provides detailed operations for you to compile the module in the OS if you use TCP to distribute incoming traffic.</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p40368054202038">The operations for Linux OSs with kernel version of 2.6.32 are different from those for Linux OSs with kernel version of 3.0 or later.</p>

<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><ul id="en-us_elb_06_0001__en-us_topic_0040807238_ul202511548152619"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li19395105819326">TOA does not support listeners using the UDP protocol.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li1251548192613">The module can work properly in the following OSs and the methods for installing other kernel versions are similar:<ul id="en-us_elb_06_0001__en-us_topic_0040807238_ul32840872153328"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li363039599271">CentOS 6.8 (kernel version 2.6.32)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li27132392153328">SUSE 11 SP3 (kernel version 3.0.76)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li42864943153328">CentOS 7/7.2 (kernel version 3.10.0)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li50240173153328">Ubuntu 16.04.3 (kernel version 4.4.0)</li><li id="en-us_elb_06_0001__li875518312810">Ubuntu 18.04 (Kernel version 4.15.0)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li49508379153328">OpenSUSE 42.2 (kernel version 4.4.36)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li42922235153328">CoreOS 10.10.5 (kernel version 4.9.16)</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li1481919299330">Debian 8.2.0 (Kernel version 3.16.0)</li></ul>
</li></ul>
</div>
<h4 class="sectiontitle">Prerequisites</h4><ul id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ul4938010110480"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li2441969610480">The development environment for compiling the module must be the same as that of the current kernel.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li5759761310480">VMs can access OS repositories.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li424754310480">Users other than <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706185726">root</strong> must have sudo permissions.</li></ul>

<h4 class="sectiontitle">Procedure</h4><ul id="en-us_elb_06_0001__en-us_topic_0040807238_ul18462952151152"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li29525308151152">In the following operations, the Linux kernel version is 3.0 or later.</li></ul>
<ol id="en-us_elb_06_0001__en-us_topic_0040807238_ol63218380101223"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li619984101223">Prepare the compilation environment.<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_p13158293282">During the installation, download the required module development package from the Internet if it cannot be found in the source.</p>
</div>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p20162879103912">The following are operations for compiling the module in different Linux OSs. Perform appropriate operations.</p>
<ul id="en-us_elb_06_0001__en-us_topic_0040807238_ul2204767811042"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li18241593104152">CentOS<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol54220366101252"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li4055961101252">Run the following command to install the GCC:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p19968249101257"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li4055961101252"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li4055961101252"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b28394106101252">sudo yum install gcc</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li41189599101337">Run the following command to install the make tool:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p48472239101329"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li41189599101337"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li41189599101337"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b33466199101334">sudo yum install make</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li25472162101720">Run the following command to install the module development package (the package header and module library must have the same version as the kernel):<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p29162162101745"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li25472162101720"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li25472162101720"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b9539006101742">sudo yum install kernel-devel-`uname -r`</strong></p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_p186077173015">During the installation, download the required module development package from the following address if it cannot be found in the source:</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p184317308294">https://mirror.netcologne.de/oracle-linux-repos/ol7_latest/getPackage/</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p13783131464117">For example, to install 3.10.0-693.11.1.el7.x86_64, run the following command:</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p987115754112"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b1358838537181418">rpm -ivh kernel-devel-3.10.0-693.11.1.el7.x86_64.rpm</strong></p>
</div>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li21968768104325">Ubuntu and Debian<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol66545700101543"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li25281999101543">Run the following command to install the GCC:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p34005774101530"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li25281999101543"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li25281999101543"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b23918182101539">sudo apt-get install gcc</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li51545356101616">Run the following command to install the make tool:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p12410682101617"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li51545356101616"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li51545356101616"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b28804583101620">sudo apt-get install make</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li10299821101840">Run the following command to install the module development package (the package header and module library must have the same version as the kernel):<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p37529166101834"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li10299821101840"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li10299821101840"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b58331826101846">sudo apt-get install linux-headers-`uname -r`</strong></p>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li59559361104413">SUSE<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol43706869101931"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li57817506101931">Run the following command to install the GCC:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p36523419101941"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li57817506101931"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li57817506101931"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b24577638101946">sudo zypper install gcc</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li4060148310201">Run the following command to install the make tool:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p61556112102538"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li4060148310201"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li4060148310201"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b48115810102542">sudo zypper install make</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li41846808102618">Run the following command to install the module development package (the package header and module library must have the same version as the kernel):<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p1566621410267"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li41846808102618"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li41846808102618"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b6134036102625">sudo zypper install kenel-default-devel</strong></p>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li28835089104448">CoreOS<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p7171296102656"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li28835089104448"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li28835089104448"></a>For CoreOS, the module will be compiled in a container, and it must be started before the module is compiled. </p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p24450774111143">For detailed operations, see the CoreOS documentation. Obtain the documentation from the following link:</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p6117938310273"><a href="https://coreos.com/os/docs/latest/kernel-modules.html" target="_blank" rel="noopener noreferrer">https://coreos.com/os/docs/latest/kernel-modules.html</a></p>
</li></ul>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li62908976101351">Compile the module.<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol58804181102820"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li24937844102832">Use the git tool and run the following command to download the module source code:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p3456575102833"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li24937844102832"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li24937844102832"></a><strong id="en-us_elb_06_0001__b1965520424020">git</strong> <strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b1430318017555">clone</strong> <a href="https://github.com/Huawei/TCP_option_address" target="_blank" rel="noopener noreferrer">https://github.com/Huawei/TCP_option_address.git</a></p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p5667814711351">If the git tool is not installed, download the module source code from the following link:</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p1155615349594"><a href="https://github.com/Huawei/TCP_option_address" target="_blank" rel="noopener noreferrer">https://github.com/Huawei/TCP_option_address</a></p>
</div>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li6196486102859">Run the following commands to enter the source code directory and compile the module:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p16473417102853"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li6196486102859"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li6196486102859"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b27547131102911">cd src</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p14043032102853"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b5493937510297">make</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p4583111102913">If no warning or error code is prompted, the compilation was successful. Verify that the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270619842">toa.ko</strong> file was generated in the current directory.</p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__p11483322193011">If error message "config_retpoline=y but not supported by the compiler, Compiler update recommended" is displayed, the GCC version is too old. Upgrade the GCC to a later version.</p>
</div>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li64464787101517"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li64464787101517"></a><a name="en-us_topic_0040807238_li64464787101517"></a>Load the module.<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol5287794010321"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li3120107010321">Run the following command to load the module:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p12239136103148"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li3120107010321"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li3120107010321"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b41969787103157">sudo insmod toa.ko</strong></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li10325746103233">Run the following command to check the module loading and to view the kernel output information:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p13924803103225"><a name="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li10325746103233"></a><a name="en-us_topic_0040807238_en-us_topic_0082429126_li10325746103233"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b36851266103239">dmesg | grep TOA</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p2736465310348">If <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706191030">TOA: toa loaded</strong> is displayed in the command output, the module has been loaded.</p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p37625132141930">After compiling the CoreOS module in the container, copy it to the host system and then load it. The container for compiling the module shares the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706181757">/lib/modules</strong> directory with the host system, so you can copy the module in the container to this directory, allowing the host system to use it.</p>
</div>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li5509149710168">Set the script to enable it to automatically load the module.<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p60271419114243"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li5509149710168"></a><a name="en-us_topic_0040807238_li5509149710168"></a>To make the module take effect when the system starts, add the command for loading the module to your startup script.</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p15255995114234">You can use either of the following methods to automatically load the module:</p>
<ul id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ul37980506114330"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li47205357114342">Add the command for loading the module to a customized startup script as required.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li2072453114330">Perform the following operations to configure a startup script:<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_ol9533376113654"><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li17856029113753">Create the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706182347">toa.modules</strong> file in the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706182341">/etc/sysconfig/modules/</strong> directory. This file contains the module loading script.<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p3772273815617">The following is an example of the content in the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706182516">toa.modules</strong> file.</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p527401281571"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b48991061571">#!/bin/sh</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p440919551571"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b63639512155146">/sbin/modinfo -F filename /root/toa/toa.ko &gt; /dev/null 2&gt;&amp;1</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p146785741571"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b649983061571">if [ $? -eq 0 ]; then</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p481138501571"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b31679627155151">/sbin/insmod /root/toa/toa.ko</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p49077741571"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b441699731571">fi</strong></p>
<p class="notestext" id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p26189965113654"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706182551">/root/toa/toa.ko</strong> is the path of the module file. You need to replace it with their actual path.</p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_li21949745151257">Run the following command to add execution permissions for the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b33448445894828">toa.modules</strong> startup script:<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p41012405113654"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b9433588155116">sudo</strong> <strong id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_b17608931155053">chmod +x /etc/sysconfig/modules/toa.modules</strong></p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p1472124411372">If the kernel is upgraded, the current module will no longer match. Compile the module again.</p>
</div>
</li></ol>
</li></ul>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li30261163101721">Install the module on multiple nodes.<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p47062162103436"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li30261163101721"></a><a name="en-us_topic_0040807238_li30261163101721"></a>To load the module in the same OSs, copy the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b842352706192442">toa.ko</strong> file to VMs where the module is to be loaded and then perform the operations in <a href="#en-us_elb_06_0001__en-us_topic_0040807238_li64464787101517">3</a>.</p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p4718828411918">After the module is successfully loaded, applications can obtain the real IP address contained in the request.</p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_en-us_topic_0082429126_p5233494151921">The OS of the node must have the same version as the kernel.</p>
</div>
</li><li id="en-us_elb_06_0001__li13108152093419">Verify the module.<p id="en-us_elb_06_0001__p1090951933512"><a name="en-us_elb_06_0001__li13108152093419"></a><a name="li13108152093419"></a>After the module is successfully installed, the source address can be directly obtained. The following provides an example for verification. </p>
<p id="en-us_elb_06_0001__p16914161813510">Run the following command to start a simple HTTP service on the backend server where Python is installed:</p>
<p id="en-us_elb_06_0001__p18915518173513"><strong id="en-us_elb_06_0001__b799313811375">python -m SimpleHTTPServer </strong><em id="en-us_elb_06_0001__i3630349163718">port</em></p>
<p id="en-us_elb_06_0001__p55822819372">The value of <strong id="en-us_elb_06_0001__b18840758172714">port</strong> must be the same as the port configured for the backend server, and the default value is <strong id="en-us_elb_06_0001__b687017284288">80</strong>.</p>
<p id="en-us_elb_06_0001__p14915101811354">Access the IP address of the load balancer from a client. Access logs on the server are as follows:</p>
<pre class="screen" id="en-us_elb_06_0001__screen18294141918406"><strong id="en-us_elb_06_0001__b10381524194019">192.168.0.90</strong> - - [06/Aug/2020 14:24:21] "GET / HTTP/1.1" 200 –</pre>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__p19886349114120">192.168.0.90 indicates the client's source IP address that is obtained by the backend server.</p>
</div>
</li></ol>

<ul id="en-us_elb_06_0001__en-us_topic_0040807238_ul1366563415124"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li1475745415124"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b660722239381">In the following operations, the Linux kernel version is 2.6.32.</strong><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_topic_0040807238_p4076543115124">The TOA plug-in supports the OSs (CentOS 6.8 image) with a kernel of 2.6.32-xx. Perform the following steps to configure the module:</p>
</div>
</li></ul>
<ol id="en-us_elb_06_0001__en-us_topic_0040807238_ol2933916210372"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li4621377110408">Obtain the kernel source code package <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270692736">Linux-2.6.32-220.23.1.el6.x86_64.rs.src.tar.gz</strong> containing the module from the following link:<p id="en-us_elb_06_0001__en-us_topic_0040807238_p12007427103820"><a href="http://kb.linuxvirtualserver.org/images/3/34/Linux-2.6.32-220.23.1.el6.x86_64.rs.src.tar.gz" target="_blank" rel="noopener noreferrer">http://kb.linuxvirtualserver.org/images/3/34/Linux-2.6.32-220.23.1.el6.x86_64.rs.src.tar.gz</a></p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li30453689104113">Decompress the kernel source code package.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li35191858104142">Modify compilation parameters.<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_ol48291268104142"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li31968231104142">Open the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270693357">linux-2.6.32-220.23.1.el6.x86_64.rs</strong> folder.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li19278629104142">Edit the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b8423527069344">net/toa/toa.h</strong> file.<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p39289933104142">Change the value of <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270693430">#define TCPOPT_TOA200</strong> to <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270693434">#define TCPOPT_TOA254</strong>.</p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li29646770104142">On the shell page, run the following commands:<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p65494340104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li29646770104142"></a><a name="en-us_topic_0040807238_li29646770104142"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b52578154104142">sed -i 's/CONFIG_IPV6=m/CONFIG_IPV6=y/g' .config</strong></p>
<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p3441339104142"><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b30972058104142">echo -e '\n# toa\nCONFIG_TOA=m' &gt;&gt; .config</strong></p>
<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p10313071104142">After the configuration, the IPv6 module is compiled into the kernel. TOA is compiled into a separate module and can be independently started and stopped.</p>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li25708779104142">Edit <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b8423527069355">Makefile</strong>.<p id="en-us_elb_06_0001__en-us_topic_0040807238_p30052423104142">You can add a description to the end of <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270693541">EXTRAVERSION =</strong>. This description will be displayed in <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270693553">uname -r</strong>, for example, <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b8423527069361">-toa</strong>.</p>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li2036356104142">Run the following command to compile the software package:<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p18327212104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li2036356104142"></a><a name="en-us_topic_0040807238_li2036356104142"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b30727182104142">make -j <em id="en-us_elb_06_0001__en-us_topic_0040807238_i8109189104142">n</em></strong></p>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p class="text" id="en-us_elb_06_0001__en-us_topic_0040807238_p52864571104142"><em id="en-us_elb_06_0001__en-us_topic_0040807238_i84235269793842">n</em> indicates the number of vCPUs. For example, if there are four vCPUs, <em id="en-us_elb_06_0001__en-us_topic_0040807238_i84235269795049">n</em> must be set to <em id="en-us_elb_06_0001__en-us_topic_0040807238_i84235269795055">4</em>.</p>
</div>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li6019092104142">Run the following command to install the module:<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p54171829104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li6019092104142"></a><a name="en-us_topic_0040807238_li6019092104142"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b17784415104142">make modules_install</strong></p>
<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p25842011104142">The following information is displayed.</p>
<span class="figcap"><b>Figure 1 </b>Installing the module</span><br><span><img id="en-us_elb_06_0001__en-us_topic_0040807238_image31792246104555" src="en-us_image_0171245428.jpg"></span>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li23613380104142">Run the following command to install the kernel:<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p11193834104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li23613380104142"></a><a name="en-us_topic_0040807238_li23613380104142"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b33635650104142">make install</strong></p>
<p class="litext" id="en-us_elb_06_0001__en-us_topic_0040807238_p34285395104142">The following information is displayed.</p>
<span class="figcap"><b>Figure 2 </b>Installing the kernel</span><br><span><img id="en-us_elb_06_0001__en-us_topic_0040807238_image5805175104737" src="en-us_image_0171245430.jpg"></span>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li45222397104142">Open the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b8423527069532">/boot/grub/grub.conf</strong> file and configure the kernel to start up when the system starts.<ol type="a" id="en-us_elb_06_0001__en-us_topic_0040807238_ol4348392104142"><li id="en-us_elb_06_0001__en-us_topic_0040807238_li39135532104142">Change the default startup kernel from the first kernel to the zeroth kernel by changing <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270610348">default=1</strong> to <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270610351">default=0</strong>.</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li16675475104142">Add the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270610219">nohz=off</strong> parameter to the end of the line containing the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270610237">vmlinuz-2.6.32-toa</strong> kernel. If <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270695554">nohz</strong> is not disabled, the CPU0 usage may be high and overload the kernel.<span class="figcap"><b>Figure 3 </b>Configuration file</span><br><span><img id="en-us_elb_06_0001__en-us_topic_0040807238_image43295505105040" src="en-us_image_0171245432.jpg"></span>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li37283502104142">Save the modification and exit. Restart the OS.<p id="en-us_elb_06_0001__en-us_topic_0040807238_p7199104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li37283502104142"></a><a name="en-us_topic_0040807238_li37283502104142"></a>During the restart, the system will load the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270695656">vmlinuz-2.6.32-toa</strong> kernel.</p>
</li></ol>
</li><li id="en-us_elb_06_0001__en-us_topic_0040807238_li64794104142">After the restart, run the following command to load the module:<p id="en-us_elb_06_0001__en-us_topic_0040807238_p583153104142"><a name="en-us_elb_06_0001__en-us_topic_0040807238_li64794104142"></a><a name="en-us_topic_0040807238_li64794104142"></a><strong id="en-us_elb_06_0001__en-us_topic_0040807238_b5248379104142">modprobe toa</strong></p>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p47235419104142">Add the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270695743">modprobe toa</strong> command to both the startup script and the system scheduled monitoring script.</p>
<span class="figcap"><b>Figure 4 </b>Adding the <strong id="en-us_elb_06_0001__en-us_topic_0040807238_b84235270695854">modprobe toa</strong> command</span><br><span><img id="en-us_elb_06_0001__en-us_topic_0040807238_image54734444105614" src="en-us_image_0171245434.jpg"></span>
<p id="en-us_elb_06_0001__en-us_topic_0040807238_p35151001105737">After the module is loaded, query the kernel information.</p>
<span class="figcap"><b>Figure 5 </b>Querying the kernel</span><br><span><img id="en-us_elb_06_0001__en-us_topic_0040807238_image66154589105833" src="en-us_image_0171245435.jpg"></span>
</li><li id="en-us_elb_06_0001__li6161144213428">Verify the module.<p id="en-us_elb_06_0001__en-us_elb_06_0001_p1090951933512"><a name="en-us_elb_06_0001__li6161144213428"></a><a name="li6161144213428"></a>After the module is successfully installed, the source address can be directly obtained. The following provides an example for verification. </p>
<p id="en-us_elb_06_0001__en-us_elb_06_0001_p16914161813510">Run the following command to start a simple HTTP service on the backend server where Python is installed:</p>
<p id="en-us_elb_06_0001__en-us_elb_06_0001_p18915518173513"><strong id="en-us_elb_06_0001__en-us_elb_06_0001_b799313811375">python -m SimpleHTTPServer </strong><em id="en-us_elb_06_0001__en-us_elb_06_0001_i3630349163718">port</em></p>
<p id="en-us_elb_06_0001__en-us_elb_06_0001_p55822819372">The value of <strong id="en-us_elb_06_0001__en-us_elb_06_0001_b18840758172714">port</strong> must be the same as the port configured for the backend server, and the default value is <strong id="en-us_elb_06_0001__en-us_elb_06_0001_b687017284288">80</strong>.</p>
<p id="en-us_elb_06_0001__en-us_elb_06_0001_p14915101811354">Access the IP address of the load balancer from a client. Access logs on the server are as follows:</p>
<pre class="screen" id="en-us_elb_06_0001__en-us_elb_06_0001_screen18294141918406"><strong id="en-us_elb_06_0001__en-us_elb_06_0001_b10381524194019">192.168.0.90</strong> - - [06/Aug/2020 14:24:21] "GET / HTTP/1.1" 200 –</pre>
<img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><p id="en-us_elb_06_0001__en-us_elb_06_0001_p19886349114120">192.168.0.90 indicates the client's source IP address that is obtained by the backend server.</p>
</div>
</li></ol>



<strong>Parent topic:</strong> <a href="en-us_elb_06_0000.html">Appendix</a>



