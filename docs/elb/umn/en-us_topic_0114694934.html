<a name="en-us_topic_0114694934"></a><a name="en-us_topic_0114694934"></a>

<h1 class="topictitle1">Forwarding Policy</h1>
<h4 class="sectiontitle">Scenarios</h4><p id="en-us_topic_0114694934__p61862355136">You can add forwarding policies to HTTP or HTTPS listeners to forward requests to different backend server groups based on domain names or URLs.</p>
<p id="en-us_topic_0114694934__p10421151131318">This is suited for applications that are deployed on multiple backend servers and provide multiple types of services such as videos, images, audios, and texts.</p>
<p id="en-us_topic_0114694934__p36879611417">A forwarding policy consists of a forwarding rule and an action.</p>
<ul id="en-us_topic_0114694934__ul266610914141"><li id="en-us_topic_0114694934__li982513111417">There are two types of forwarding rules: domain name and URL.</li><li id="en-us_topic_0114694934__li66662916141">The only supported action is to forward requests to another backend server group.</li></ul>

<h4 class="sectiontitle">Constraints and Limitations</h4><ul id="en-us_topic_0114694934__ul144354355615"><li id="en-us_topic_0114694934__li1724695575617">Forwarding policies can be added only to HTTP and HTTPS listeners.</li><li id="en-us_topic_0114694934__li185774135582">When you add a forwarding policy, note the following:<ul id="en-us_topic_0114694934__ul8258223135820"><li id="en-us_topic_0114694934__en-us_topic_0114694934_li123603334264">Each URL path must exist on the backend servers. Otherwise, the backend servers return 404 to the load balancer.</li><li id="en-us_topic_0114694934__en-us_topic_0114694934_li11682841173019">A URL path cannot be configured for two forwarding policies.</li><li id="en-us_topic_0114694934__li825822395819">In regular expression match, the characters are matched sequentially, and matching ends when any rule is successfully matched. Matching rules cannot overlap with each other.</li></ul>
</li><li id="en-us_topic_0114694934__li14627181705">After you add a forwarding policy, the load balancer forwards requests based on the specified domain name or URL:<ul id="en-us_topic_0114694934__ul1265917191707"><li id="en-us_topic_0114694934__en-us_topic_0114694934_li950792319264">If the domain name or URL in a request matches that specified in the forwarding policy, the request is forwarded to the backend server group you select when you add the forwarding policy.</li><li id="en-us_topic_0114694934__li166591619902">If the domain name or URL in a request does not match that specified in the forwarding policy, the request is forwarded to the default backend server group of the listener.</li></ul>
</li></ul>
<span class="cautiontitle"><img src="public_sys-resources/caution_3.0-en-us.png"> </span><p id="en-us_topic_0114694934__p20307140122519">If you add a forwarding policy that is the same as an existing forwarding policy, there will be a conflict. Even if you delete the existing forwarding policy, the newly-added forwarding policy is still in the <strong id="en-us_topic_0114694934__b12532441193013">Faulty</strong> state. Delete both the forwarding policies and add two different forwarding policies.</p>
</div>
<p id="en-us_topic_0114694934__p8969141610243"></p>

<h4 class="sectiontitle">Adding a Forwarding Policy</h4><ol id="en-us_topic_0114694934__ol316810121211"><li id="en-us_topic_0114694934__li677391520332">Log in to the management console.</li><li id="en-us_topic_0114694934__li675519100420">In the upper left corner of the page, click <span><img id="en-us_topic_0114694934__en-us_topic_0240829509_image177714713415" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="en-us_topic_0114694934__li83736197297">Hover on <span><img id="en-us_topic_0114694934__en-us_topic_0052569751_en-us_topic_0052569751_image616618613" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b9121102522212">Service List</strong> and choose <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b61222025142217">Network</strong> &gt; <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b4124425142210">Elastic Load Balancing</strong>.</li><li id="en-us_topic_0114694934__li191687112127">Locate the load balancer and click its name.</li><li id="en-us_topic_0114694934__li781950135113">Click <strong id="en-us_topic_0114694934__b842352706153131">Listeners</strong>, locate the listener, and click its name.</li><li id="en-us_topic_0114694934__li535360125313">Click <strong id="en-us_topic_0114694934__b842352706153219">Add</strong> on the right of <strong id="en-us_topic_0114694934__b842352706153224">Forwarding Policies</strong>.</li><li id="en-us_topic_0114694934__li119210113540">In the <strong id="en-us_topic_0114694934__b842352706153247">Add Forwarding Policy</strong> dialog box, configure the parameters based on <a href="#en-us_topic_0114694934__table10859681016">Table 1</a>.</li><li id="en-us_topic_0114694934__li9629179153817">Click <strong id="en-us_topic_0114694934__b84235270620406">OK</strong>.<p id="en-us_topic_0114694934__p1676791018389">Alternatively, locate the load balancer in the load balancer list and click the name of the listener in the <strong id="en-us_topic_0114694934__b7677399392">Listener</strong> column. In the <strong id="en-us_topic_0114694934__b11535454103812">Listeners</strong> area, click <strong id="en-us_topic_0114694934__b1356824873911">Add</strong> on the right of <strong id="en-us_topic_0114694934__b5613185214391">Forwarding Policies</strong> and then add a forwarding policy.</p>
</li></ol>

<a name="en-us_topic_0114694934__table10859681016"></a><a name="table10859681016"></a><table cellpadding="4" cellspacing="0" summary="" id="en-us_topic_0114694934__table10859681016" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Forwarding policy parameters</caption><thead align="left"><tr id="en-us_topic_0114694934__row109196141011"><th align="left" class="cellrowborder" valign="top" width="16.16161616161616%" id="mcps1.3.3.3.2.5.1.1"><p id="en-us_topic_0114694934__p205701231181017"><strong id="en-us_topic_0114694934__b84235270615222">Item</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="19.321932193219325%" id="mcps1.3.3.3.2.5.1.2"><p id="en-us_topic_0114694934__p69376201010"><strong>Parameter</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="47.97479747974798%" id="mcps1.3.3.3.2.5.1.3"><p id="en-us_topic_0114694934__p294665107"><strong id="en-us_topic_0114694934__b1941777898">Description</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.541654165416542%" id="mcps1.3.3.3.2.5.1.4"><p id="en-us_topic_0114694934__p119718601010"><strong id="en-us_topic_0114694934__b197517251">Example Value</strong></p>
</th>
</tr>
</thead>
<tbody><tr id="en-us_topic_0114694934__row141006651018"><td class="cellrowborder" rowspan="5" valign="top" width="16.16161616161616%" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p457093112107">Configure Forwarding Policy</p>
</td>
<td class="cellrowborder" valign="top" width="19.321932193219325%" headers="mcps1.3.3.3.2.5.1.2 "><p id="en-us_topic_0114694934__p171025641010">Name</p>
</td>
<td class="cellrowborder" valign="top" width="47.97479747974798%" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p510396141018">Specifies the forwarding policy name.</p>
</td>
<td class="cellrowborder" valign="top" width="16.541654165416542%" headers="mcps1.3.3.3.2.5.1.4 "><p id="en-us_topic_0114694934__p5104136141017">forwarding_policy-q582</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row15105761109"><td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p2107062104">Domain Name</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.2 "><p id="en-us_topic_0114694934__p210718619109">Specifies the domain name used for forwarding requests. The domain name in the request must exactly match that in the forwarding policy. You need to specify either a domain name or URL.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p4108167108">www.test.com</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row11113116161018"><td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p171138691020">URL Matching Rule</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.2 "><ul id="en-us_topic_0114694934__ul141168619107"><li id="en-us_topic_0114694934__li1711619619105"><strong id="en-us_topic_0114694934__b842352706195236">Exact match</strong><p id="en-us_topic_0114694934__p17117367106">The request URL is identical to the preset URL.</p>
</li><li id="en-us_topic_0114694934__li1511706191018"><strong id="en-us_topic_0114694934__b1859428008">Prefix match</strong><p id="en-us_topic_0114694934__p1111820611102">The requested URL starts with the specified URL string.</p>
</li><li id="en-us_topic_0114694934__li1812017619105"><strong id="en-us_topic_0114694934__b1524499073">Regular expression match</strong>The requested URL matches the specified URL string based on the regular expression.<span class="notetitle"> NOTE: </span><ul id="en-us_topic_0114694934__ul1916119392479"><li id="en-us_topic_0114694934__li6161539114715"><strong id="en-us_topic_0114694934__b18733217588">Exact match</strong> has the highest priority, followed by <strong id="en-us_topic_0114694934__b039785165814">Prefix match</strong>. Regular expression match has the lowest priority.</li><li id="en-us_topic_0114694934__li131612397471">If you use prefix match, the longest string is chosen. For example, if there are two preset URLs: <strong id="en-us_topic_0114694934__b75310422424">/elb</strong> and <strong id="en-us_topic_0114694934__b19532154284214">/elbvip</strong> and the accessed URL is <strong id="en-us_topic_0114694934__b5533124216429">/elbvipplus</strong>, <strong id="en-us_topic_0114694934__b1253317424425">/elbvip</strong> is preferentially matched.</li></ul>
</div>

</li></ul>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p19123167101">Exact match</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row4184174112152"><td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p911056121017">URL</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.2 "><p id="en-us_topic_0114694934__p18111176151015">Specifies the URL used for forwarding requests.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p511313661015">/login.php</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row151292617103"><td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p413126171017">Description</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.2 "><p id="en-us_topic_0114694934__p013218618109">Provides supplementary information about the forwarding policy.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p213376191011">N/A</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row2079614577109"><td class="cellrowborder" valign="top" width="16.16161616161616%" headers="mcps1.3.3.3.2.5.1.1 "><p id="en-us_topic_0114694934__p7796857121015">Add Backend Server Group</p>
</td>
<td class="cellrowborder" valign="top" width="19.321932193219325%" headers="mcps1.3.3.3.2.5.1.2 "><p id="en-us_topic_0114694934__p19796145771015">Backend Server Group</p>
</td>
<td class="cellrowborder" valign="top" width="47.97479747974798%" headers="mcps1.3.3.3.2.5.1.3 "><p id="en-us_topic_0114694934__p81191352185715">Specifies whether a new or existing backend server group will be used. Select <strong id="en-us_topic_0114694934__b311819527573">Create new</strong> or <strong id="en-us_topic_0114694934__b16118105212572">Use existing</strong>.</p>
<p id="en-us_topic_0114694934__p184301216593">If you select <strong id="en-us_topic_0114694934__b9300195912574">Create new</strong>, configure the parameters based on <a href="en-us_topic_0052569729.html#en-us_topic_0052569729__table299811529239">Table 1</a> and <a href="en-us_topic_0052569729.html#en-us_topic_0052569729__table1022053182319">Table 2</a>.</p>
<span class="notetitle"> NOTE: </span><p id="en-us_topic_0114694934__p13859616142716">The backend protocol can only be HTTP.</p>
</div>
</td>
<td class="cellrowborder" valign="top" width="16.541654165416542%" headers="mcps1.3.3.3.2.5.1.4 "><p id="en-us_topic_0114694934__p87961057131011">Create new</p>
</td>
</tr>
</tbody>
</table>


<h4 class="sectiontitle">URL Matching Example</h4><p id="en-us_topic_0114694934__p1489514318593">The following table lists how a URL is matched, and <a href="#en-us_topic_0114694934__fig87121434403">Figure 1</a> shows how a request is forwarded to a backend server group.</p>


<table cellpadding="4" cellspacing="0" summary="" id="en-us_topic_0114694934__table5831113119590" frame="border" border="1" rules="all"><caption><b>Table 2 </b>URL matching</caption><thead align="left"><tr id="en-us_topic_0114694934__row4697541666"><th align="left" class="cellrowborder" valign="top" id="mcps1.3.5.2.7.1.1"><p id="en-us_topic_0114694934__p669813413615"><strong id="en-us_topic_0114694934__b842352706142041">URL Matching Rule</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" id="mcps1.3.5.2.7.1.2"><p id="en-us_topic_0114694934__p969884114610"><strong id="en-us_topic_0114694934__b8423527069304">URL</strong></p>
</th>
<th align="left" class="cellrowborder" colspan="4" valign="top" id="mcps1.3.5.2.7.1.3"><p id="en-us_topic_0114694934__p193919591169"><strong id="en-us_topic_0114694934__b8423527069308">URL in the Forwarding Policy</strong></p>
</th>
</tr>
</thead>
<tbody><tr id="en-us_topic_0114694934__row1289643195912"><td class="cellrowborder" valign="top" width="19.69393878775755%" headers="mcps1.3.5.2.7.1.1 "><p id="en-us_topic_0114694934__p17134761873">-</p>
</td>
<td class="cellrowborder" valign="top" width="15.053010602120423%" headers="mcps1.3.5.2.7.1.2 "><p id="en-us_topic_0114694934__p17134567713">-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p1089663175919">/elb/index.html</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p6896113175915">/elb</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p1689673113599">/elb[^\s]*</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p3896731205919">/index.html</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row2896103116597"><td class="cellrowborder" valign="top" width="19.69393878775755%" headers="mcps1.3.5.2.7.1.1 "><p id="en-us_topic_0114694934__p1689783116593">Exact match</p>
</td>
<td class="cellrowborder" rowspan="3" valign="top" width="15.053010602120423%" headers="mcps1.3.5.2.7.1.2 "><p id="en-us_topic_0114694934__p118978317599">/elb/index.html</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p38975312592">√</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p17897103116599">-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p289713114590">-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p1189733155917">-</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row198979312599"><td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.1 "><p id="en-us_topic_0114694934__p7897103195912">Prefix match</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.2 "><p id="en-us_topic_0114694934__p989713315591">√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p1589763110598">√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p1489753118593">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p18897183115599">-</p>
</td>
</tr>
<tr id="en-us_topic_0114694934__row18971031195914"><td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.1 "><p id="en-us_topic_0114694934__p13897631125920">Regular expression match</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.2 "><p id="en-us_topic_0114694934__p289715311594">√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p11897173105916">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p489714312592">√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.5.2.7.1.3 "><p id="en-us_topic_0114694934__p10897731155915">-</p>
</td>
</tr>
</tbody>
</table>

<a name="en-us_topic_0114694934__fig87121434403"></a><a name="fig87121434403"></a><span class="figcap"><b>Figure 1 </b>Request forwarding</span><br><span><img id="en-us_topic_0114694934__image12237718166" src="en-us_image_0114721717.jpg"></span>
<p id="en-us_topic_0114694934__p50124043202039">In this figure, the system first searches for an exact match of the requested URL (/elb_gls/glossary.html). If there is no exact match, the system searches for a prefix match. If a match is found, the request is forwarded to backend server group 2 even if a regular expression match is also found, because the prefix match has a higher priority.</p>
<h4 class="sectiontitle">Modifying a Forwarding Policy</h4><ol id="en-us_topic_0114694934__ol648102516228"><li id="en-us_topic_0114694934__li1348514094915">Log in to the management console.</li><li id="en-us_topic_0114694934__li2485180174918">In the upper left corner of the page, click <span><img id="en-us_topic_0114694934__en-us_topic_0240829509_image177714713415_1" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="en-us_topic_0114694934__li17301740102218">Hover on <span><img id="en-us_topic_0114694934__en-us_topic_0052569751_en-us_topic_0052569751_image616618613_1" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b9121102522212_1">Service List</strong> and choose <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b61222025142217_1">Network</strong> &gt; <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b4124425142210_1">Elastic Load Balancing</strong>.</li><li id="en-us_topic_0114694934__li149225122216">Locate the load balancer and click its name.</li><li id="en-us_topic_0114694934__li349122516225">Click <strong id="en-us_topic_0114694934__b842352706163816">Listeners</strong>, locate the listener, and click its name.</li><li id="en-us_topic_0114694934__li54992502220">Click <strong id="en-us_topic_0114694934__b84235270616403">Forwarding Policies</strong>. </li><li id="en-us_topic_0114694934__li6498251224">Locate the forwarding policy and click <span><img id="en-us_topic_0114694934__image111401415717" src="en-us_image_0238446941.png"></span> on the right of its name.</li><li id="en-us_topic_0114694934__li1149725182220">In the <strong id="en-us_topic_0114694934__b2589123114410">Modify Forwarding Policy</strong> dialog box, modify the parameters and click <strong id="en-us_topic_0114694934__b7628183919411">OK</strong>.</li></ol>

<h4 class="sectiontitle">Deleting a Forwarding Policy</h4><ol id="en-us_topic_0114694934__ol118712153583"><li id="en-us_topic_0114694934__li2071031219497">Log in to the management console.</li><li id="en-us_topic_0114694934__li2710161212497">In the upper left corner of the page, click <span><img id="en-us_topic_0114694934__en-us_topic_0240829509_image177714713415_2" src="en-us_image_0241356603.png"></span> and select the desired region and project.</li><li id="en-us_topic_0114694934__li1974332122111">Hover on <span><img id="en-us_topic_0114694934__en-us_topic_0052569751_en-us_topic_0052569751_image616618613_2" src="en-us_image_0000001120894978.png"></span> in the upper left corner to display <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b9121102522212_2">Service List</strong> and choose <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b61222025142217_2">Network</strong> &gt; <strong id="en-us_topic_0114694934__en-us_topic_0052569751_b4124425142210_2">Elastic Load Balancing</strong>.</li><li id="en-us_topic_0114694934__li2341383911">Locate the load balancer and click its name.</li><li id="en-us_topic_0114694934__li2651933153113">Click <strong id="en-us_topic_0114694934__b862941280">Listeners</strong>, locate the listener, and click its name.</li><li id="en-us_topic_0114694934__li191381723215">Click <strong id="en-us_topic_0114694934__b547842243">Forwarding Policies</strong>. </li><li id="en-us_topic_0114694934__li12974142113216">Locate the forwarding policy and click <span><img id="en-us_topic_0114694934__image1347163801816" src="en-us_image_0238447292.png"></span> on the right of its name.</li><li id="en-us_topic_0114694934__li29581516118">Click <strong id="en-us_topic_0114694934__b84235270685341">Yes</strong>.</li></ol>




<strong>Parent topic:</strong> <a href="elb_ug_jt_0013.html">Advanced Features of HTTP/HTTPS Listeners</a>



