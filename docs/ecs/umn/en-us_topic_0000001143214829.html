<a name="EN-US_TOPIC_0000001143214829"></a><a name="EN-US_TOPIC_0000001143214829"></a>

<h1 class="topictitle1">How Do I Configure atop and kdump on Linux ECSs for Performance Analysis?</h1>
<div id="body8662426"><div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section153594317569"><h4 class="sectiontitle">Scenarios</h4><p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1825965612915">This section describes how you can configure atop and kdump on Linux ECSs for performance analysis.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p625915561292">The method for configuring atop varies with the OS version.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p01377320493">atop</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul146174424492"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1961221410355"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section0959133015350">Introduction to atop</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li71431837142111"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18897192721320">Configuring atop for CentOS 8 or RHEL 8</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li183484717215"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1972319582310">Configuring atop for CentOS 7, RHEL 7, or EulerOS</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li49631147222"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section3205824181917">Configuring atop for SUSE 12 or SUSE 15</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li154693223619"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section012793312620">Configuring atop Using Its Source Package for SUSE, Fedora, Debian or Ubuntu</a></li></ul>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p8280147134915">kdump</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul175841293514"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li165821203517"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1410131164120">Precautions for Configuring kdump</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li25816125352"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18450171174120">Introduction to kdump</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1758012153514"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section134381494320">Configuring kdump</a></li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1584123353"><a href="#EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1296112934412">Checking Whether kdump Configurations Have Taken Effect</a></li></ul>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section0959133015350"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section0959133015350"></a><a name="en-us_topic_0178319250_section0959133015350"></a><h4 class="sectiontitle">Introduction to atop</h4><p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1711204117359">atop is a monitor for Linux that can report the activity of all processes and resource consumption by all processes at regular intervals. It shows system-level activity related to the CPU, memory, disks, and network layers for every process. It also logs system and process activities daily and saves the logs in disks for long-term analysis.</p>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18897192721320"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18897192721320"></a><a name="en-us_topic_0178319250_section18897192721320"></a><h4 class="sectiontitle">Configuring atop for CentOS 8 or RHEL 8</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol4695887141"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li136951689149">Run the following command to download the atop package:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p569519821411"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li136951689149"></a><a name="en-us_topic_0178319250_li136951689149"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b76953811143"># wget https://www.atoptool.nl/download/atop-2.6.0-1.el8.x86_64.rpm</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1169548141416">Run the following command to install the package:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p56951188142"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1169548141416"></a><a name="en-us_topic_0178319250_li1169548141416"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b116951081144"># rpm -ivh atop-2.6.0-1.el8.x86_64.rpm</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1969519815141">Run the following command to modify the configuration file of atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p6695178131410"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1969519815141"></a><a name="en-us_topic_0178319250_li1969519815141"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b17695881147"># vi /etc/default/atop</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p769517819141">Modify the following parameters, save the modification, and exit:</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul16956817146"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li6695138151418">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b610410341189">LOGINTERVAL</strong> to, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1211211341088">15</strong>. The default value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1511333413816">LOGINTERVAL</strong> is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b5113173410820">600</strong>, in seconds.</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li16952841418">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b823154910819">LOGGENERATIONS</strong> if needed. The default retention period of atop logs is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b192390491582">28</strong> days.<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen1833119354144">LOGINTERVAL=15
LOGGENERATIONS=28 </pre>
</li></ul>
</li></ol><ol start="4" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol19695148191413"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li56958812146">Run the following command to restart atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p2069512812143"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li56958812146"></a><a name="en-us_topic_0178319250_li56958812146"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1669508101419"># systemctl restart atop</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li17695188131419">Run the following command to check the status of atop. If <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1661517581496">active (running)</strong> is displayed in the output, atop is running properly.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p13695158171415"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b869511871413"># systemctl status atop</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen33401547158">atop.service - Atop advanced performance monitor
Loaded: loaded (/usr/lib/systemd/system/atop.service; enabled; vendor preset: disabled)
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b83541844159">Active: active (running)</strong> since Sat 2021-06-19 14:46:10 CST; 8s ago
Docs: man:atop(1)
Process: 6391 ExecStartPost=/usr/bin/find ${LOGPATH} -name atop_* -mtime +${LOGGENERATIONS} -exec rm -v {} ; (code=exited, status=0/SUCCESS)
Process: 6388 ExecStartPre=/bin/sh -c test -n "$LOGGENERATIONS" -a "$LOGGENERATIONS" -eq "$LOGGENERATIONS" (code=exited, status=0/SUCCESS)
Process: 6387 ExecStartPre=/bin/sh -c test -n "$LOGINTERVAL" -a "$LOGINTERVAL" -eq "$LOGINTERVAL" (code=exited, status=0/SUCCESS)
Main PID: 6390 (atop)
Tasks: 1 (limit: 23716)
Memory: 4.1M
CGroup: /system.slice/atop.service
         └─6390 /usr/bin/atop -w /var/log/atop/atop_20210619 15
 
Jun 19 14:46:10 ecs-centos8 systemd[1]: atop.service: Succeeded.
Jun 19 14:46:10 ecs-centos8 systemd[1]: Stopped Atop advanced performance monitor.
Jun 19 14:46:10 ecs-centos8 systemd[1]: Starting Atop advanced performance monitor...
Jun 19 14:46:10 ecs-centos8 systemd[1]: Started Atop advanced performance monitor.</pre>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p146950811417"></p>
</li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1972319582310"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1972319582310"></a><a name="en-us_topic_0178319250_section1972319582310"></a><h4 class="sectiontitle">Configuring atop for CentOS 7, RHEL 7, or EulerOS</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol0138927171713"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li17138142721720">Run the following command to download the atop package:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p181811334191719"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li17138142721720"></a><a name="en-us_topic_0178319250_li17138142721720"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b139711426134712"># wget https://www.atoptool.nl/download/atop-2.6.0-1.el7.x86_64.rpm</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p873081319182">Upload the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b18452751805">atop-2.6.0-1.el7.x86_64.rpm</strong> package to the target ECS.</p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li10322163241711">Run the following command to install atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p73512018152317"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li10322163241711"></a><a name="en-us_topic_0178319250_li10322163241711"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b95551228181218"># rpm -ivh atop-2.6.0-1.el7.x86_64.rpm --nodeps</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li16323143215171">Run the following command to modify the configuration file of atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p14538122418235"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li16323143215171"></a><a name="en-us_topic_0178319250_li16323143215171"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b14224181812128"># vi /etc/default/atop</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p689163211236">Modify the following parameters, save the modification, and exit:</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul148931219278"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li134891121276">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1692135914185">INTERVAL</strong> to, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b3305151331915">15</strong>. The default value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1118865620407">INTERVAL</strong> is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b105309381911">600</strong>, in seconds.</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1248981252719">Change the value following <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b27768429191">-mtime</strong> if needed. The default retention period of atop logs is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b14941426201915">28</strong> days.</li></ul>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen453192312177">LOGINTERVAL=15
LOGGENERATIONS=28 </pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li232519324177">Run the following command to start atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p4390145719235"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li232519324177"></a><a name="en-us_topic_0178319250_li232519324177"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b153201035101315"># systemctl start atop</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1432514329175">Run the following command to check the status of atop. If <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1898019515101">active (running)</strong> is displayed in the output, atop is running properly.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p15892135902320"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b880175861311"># systemctl status atop</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p418318681818">atop will sample system performance data based on the specified interval and save the data to the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b12714143501211">/var/log/atop/</strong> directory.</p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen3411551161711">atop.service - Atop advanced performance monitor
Loaded: loaded (/usr/lib/systemd/system/atop.service; enabled; vendor preset: disabled)
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b10429165171712">Active: active (running)</strong> since Sat 2021-06-19 11:49:47 CST; 2h 27min ago
Docs: man:atop(1)
Process: 8231 ExecStartPost=/usr/bin/find ${LOGPATH} -name atop_* -mtime +${LOGGENERATIONS} -exec rm -v {} ; (code=exited, status=0/SUCCESS)
Process: 8225 ExecStartPre=/bin/sh -c test -n "$LOGGENERATIONS" -a "$LOGGENERATIONS" -eq "$LOGGENERATIONS" (code=exited, status=0/SUCCESS)
Process: 8223 ExecStartPre=/bin/sh -c test -n "$LOGINTERVAL" -a "$LOGINTERVAL" -eq "$LOGINTERVAL" (code=exited, status=0/SUCCESS)
Main PID: 8229 (atop)
CGroup: /system.slice/atop.service
         └─8229 /usr/bin/atop -w /var/log/atop/atop_20210619 15
 
Jun 19 11:49:47 ecs-centos7 systemd[1]: Stopped Atop advanced performance monitor.
Jun 19 11:49:47 ecs-centos7 systemd[1]: Starting Atop advanced performance monitor...
Jun 19 11:49:47 ecs-centos7 systemd[1]: Started Atop advanced performance monitor.</pre>
</li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section3205824181917"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section3205824181917"></a><a name="en-us_topic_0178319250_section3205824181917"></a><h4 class="sectiontitle">Configuring atop for SUSE 12 or SUSE 15</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol855994441912"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li8559844111911">Run the following command to download the atop source package:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p14559134461910"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li8559844111911"></a><a name="en-us_topic_0178319250_li8559844111911"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b10559944151915"># wget https://www.atoptool.nl/download/atop-2.6.0-1.src.rpm</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li65591644181915">Run the following command to install the package:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p14559144481916"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li65591644181915"></a><a name="en-us_topic_0178319250_li65591644181915"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b145591344181914"># rpm -ivh atop-2.6.0-1.src.rpm</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li2559104471918">Run the following command to install atop dependencies.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p65595443198"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li2559104471918"></a><a name="en-us_topic_0178319250_li2559104471918"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b65601044141911"># zypper -n install rpm-build ncurses-devel zlib-devel</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li7560154461914">Run the following command to compile atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p2560154411197"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li7560154461914"></a><a name="en-us_topic_0178319250_li7560154461914"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1256034415196"># cd /usr/src/packages/SPECS</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p105603449196"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b18560134441920"># rpmbuild -bb atop-2.6.0.spec</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li656094451911">Run the following command to install atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p11560124412194"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li656094451911"></a><a name="en-us_topic_0178319250_li656094451911"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1556014419193"># cd /usr/src/packages/RPMS/x86_64</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1656015449193"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b656016440197"># rpm -ivh atop-2.6.0-1.x86_64.rpm</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1256011446192">Run the following command to modify the configuration file of atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p65601441192"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1256011446192"></a><a name="en-us_topic_0178319250_li1256011446192"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b7560154416192"># vi /etc/default/atop</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1560174415192">Modify the following parameters, save the modification, and exit:</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul6560644171919"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li55601044141917">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b15041610185">LOGINTERVAL</strong> to, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1459121651815">15</strong>. The default value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b2591416191812">LOGINTERVAL</strong> is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b206015169180">600</strong>, in seconds.</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li556084471917">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b197021044496">LOGGENERATIONS</strong> if needed. The default retention period of atop logs is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1770219441495">28</strong> days.</li></ul>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen9779135314199">LOGINTERVAL=15
LOGGENERATIONS=28 </pre>
</li></ol><ol start="7" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol8560114416195"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li135606441195">Run the following command to restart atop:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p7560644111914"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li135606441195"></a><a name="en-us_topic_0178319250_li135606441195"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b95601444161916"># systemctl restart atop</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li8560844141911">Run the following command to check the status of atop. If <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1657323613184">active (running)</strong> is displayed in the output, atop is running properly.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p10560844131915"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b9560194411193"># systemctl status atop</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen196771090206">atop.service - Atop advanced performance monitor
Loaded: loaded (/usr/lib/systemd/system/atop.service; enabled; vendor preset: disabled)
Active: active (running) since Sat 2021-06-19 16:50:01 CST; 6s ago
Docs: man:atop(1)
Process: 2242 ExecStartPost=/usr/bin/find ${LOGPATH} -name atop_* -mtime +${LOGGENERATIONS} -exec rm -v {} ; (code=exited, status=0/SUCCESS)
Process: 2240 ExecStartPre=/bin/sh -c test -n "$LOGGENERATIONS" -a "$LOGGENERATIONS" -eq "$LOGGENERATIONS" (code=exited, status=0/SUCCESS)
Process: 2239 ExecStartPre=/bin/sh -c test -n "$LOGINTERVAL" -a "$LOGINTERVAL" -eq "$LOGINTERVAL" (code=exited, status=0/SUCCESS)
Main PID: 2241 (atop)
Tasks: 1 (limit: 4915)
CGroup: /system.slice/atop.service
         └─2241 /usr/bin/atop -w /var/log/atop/atop_20210619 15
 
Jun 19 16:50:01 ecs-suse15 systemd[1]: Starting Atop advanced performance monitor...
Jun 19 16:50:01 ecs-suse15 systemd[1]: Started Atop advanced performance monitor. </pre>
</li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section012793312620"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section012793312620"></a><a name="en-us_topic_0178319250_section012793312620"></a><h4 class="sectiontitle">Configuring atop Using Its Source Package for SUSE, Fedora, Debian or Ubuntu</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol887019301481"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1487013301782">Download the atop source package.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p188701430386"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1487013301782"></a><a name="en-us_topic_0178319250_li1487013301782"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b168702309811"># wget https://www.atoptool.nl/download/atop-2.6.0.tar.gz</strong></p>
</li></ol><ol start="2" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol4870153019818"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li148701530783">Decompress the source package.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p78701301586"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li148701530783"></a><a name="en-us_topic_0178319250_li148701530783"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b17870430883"># tar -zxvf atop-2.6.0.tar.gz</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li128702306817">Query the systemctl version.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p154219211892"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li128702306817"></a><a name="en-us_topic_0178319250_li128702306817"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b118701830489"># systemctl --version</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p5984112216919">If the version is 220 or later, go to the next step.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p171029352910">Otherwise, delete parameter <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1345210012717">--now</strong> from the Makefile of atop.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1194310424914"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b7870193013815"># vi atop-2.6.0/Makefile</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p53732451396">Delete parameter <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1408144182912">--now</strong> following the systemctl command.</p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen158648518106">                then   /bin/systemctl disable  atop     2&gt; /dev/null; \
                        /bin/systemctl disable  atopacct 2&gt; /dev/null; \
                        /bin/systemctl daemon-reload;                   \
                        /bin/systemctl enable   atopacct;          \
                        /bin/systemctl enable   atop;              \
                        /bin/systemctl enable   atop-rotate.timer; \</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li15870103016819">Install atop dependencies.<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul18314339104"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li18831833191016">SUSE 12 or SUSE 15<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p860993513102"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li18831833191016"></a><a name="en-us_topic_0178319250_li18831833191016"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1987073017819"># zypper -n install make gcc zlib-devel ncurses-devel</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li48321633151013">Fedora<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p184502531116"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li48321633151013"></a><a name="en-us_topic_0178319250_li48321633151013"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b38703301885"># yum install make gcc zlib-devel ncurses-devel -y</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li118321633201020">Debian 9, Debian 10, or Ubuntu<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1187015305812"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li118321633201020"></a><a name="en-us_topic_0178319250_li118321633201020"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b48705301684"># apt install make gcc zlib1g-dev libncurses5-dev libncursesw5-dev -y</strong></p>
</li></ul>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li687020308816">Compile and install atop.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p5870430884"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li687020308816"></a><a name="en-us_topic_0178319250_li687020308816"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1687043015818"># cd atop-2.6.0</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p987063016819"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b198708308819"># make systemdinstall</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1487093010819">Modify the configuration file of atop.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p2087073020818"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1487093010819"></a><a name="en-us_topic_0178319250_li1487093010819"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b58702307818"># vi /etc/default/atop</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p6870163013810">Make the following modifications, save the file, and exit.</p>
<ul id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ul1287013301282"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li48701230986">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b15886212339">LOGINTERVAL</strong> to, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b19589172143311">15</strong>. The default value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b959012183313">LOGINTERVAL</strong> is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b3590122114331">600</strong>, in seconds.</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li178704301882">Change the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1363764014335">LOGGENERATIONS</strong> if needed. The default retention period of atop logs is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b14637040173315">28</strong> days.<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen136460283110">LOGOPTS=""
LOGINTERVAL=15
LOGGENERATIONS=28
LOGPATH=/var/log/atop </pre>
</li></ul>
</li></ol><ol start="7" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol208703301083"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1687015301810">Restart atop.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1187183017817"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1687015301810"></a><a name="en-us_topic_0178319250_li1687015301810"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1587114304813"># systemctl restart atop</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li8871143014810">Run the following command to check the status of atop. If <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b348144877">active (running)</strong> is displayed in the output, atop is running properly.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p178711230289"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1787113301183"># systemctl status atop</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen1170333141215">atop.service - Atop advanced performance monitor
   Loaded: loaded (/lib/systemd/system/atop.service; enabled)
   Active: active (running) since Sun 2021-07-25 19:29:40 CST; 4s ago
     Docs: man:atop(1)
  Process: 5192 ExecStartPost=/usr/bin/find ${LOGPATH} -name atop_* -mtime +${LOGGENERATIONS} -exec rm -v {} ; (code=exited, status=0/SUCCESS)
  Process: 5189 ExecStartPre=/bin/sh -c test -n "$LOGGENERATIONS" -a "$LOGGENERATIONS" -eq "$LOGGENERATIONS" (code=exited, status=0/SUCCESS)
  Process: 5188 ExecStartPre=/bin/sh -c test -n "$LOGINTERVAL" -a "$LOGINTERVAL" -eq "$LOGINTERVAL" (code=exited, status=0/SUCCESS)
 Main PID: 5191 (atop)
   CGroup: /system.slice/atop.service
           └─5191 /usr/bin/atop -w /var/log/atop/atop_20210725 15
 
Jul 25 19:29:40 atop systemd[1]: Starting Atop advanced performance monitor...
Jul 25 19:29:40 atop systemd[1]: Started Atop advanced performance monitor.</pre>
</li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1410131164120"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1410131164120"></a><a name="en-us_topic_0178319250_section1410131164120"></a><h4 class="sectiontitle">Precautions for Configuring kdump</h4><p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p960892524112">The method for configuring kdump described in this section applies to KVM ECSs running EulerOS or CentOS 7.x. For details, see <a href="https://www.kernel.org/doc/Documentation/kdump/kdump.txt" target="_blank" rel="noopener noreferrer">Documentation for kdump</a>.</p>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18450171174120"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section18450171174120"></a><a name="en-us_topic_0178319250_section18450171174120"></a><h4 class="sectiontitle">Introduction to kdump</h4><p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1869723562">kdump is a feature of the Linux kernel that creates crash dumps in the event of a kernel crash. In the event of a kernel crash, kdump boots another Linux kernel and uses it to export an image of RAM, which is known as vmcore and can be used to debug and determine the cause of the crash.</p>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section134381494320"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section134381494320"></a><a name="en-us_topic_0178319250_section134381494320"></a><h4 class="sectiontitle">Configuring kdump</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol16406112792518"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li4406127172512">Run the following command to check whether kexec-tools is installed:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p414315774818"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li4406127172512"></a><a name="en-us_topic_0178319250_li4406127172512"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b117560516265"># rpm -q kexec-tools</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1991593311115">If it is not installed, run the following command to install it:</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p7609151364810"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1788957132719"># yum install -y kexec-tools</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1117579174410">Run the following command to enable kdump to run at system startup:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p64822016114819"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li1117579174410"></a><a name="en-us_topic_0178319250_li1117579174410"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b14387811192716"># systemctl enable kdump</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li2017519914412">Configure the parameters for the crash kernel to reserve the memory for the capture kernel.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p22547422481"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li2017519914412"></a><a name="en-us_topic_0178319250_li2017519914412"></a>Check whether the parameters are configured.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p15150184111481"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b6885141512273"># grep crashkernel /proc/cmdline</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p869644221117">If the command output is displayed, this parameter has been configured.</p>
<div class="p" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p167151856154815">Edit the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b19531959142715">/etc/default/grub</strong> file to configure the following parameters:<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen851964404110">GRUB_TIMEOUT=5
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=rhel00/root rd.lvm.lv=rhel00/swap
rhgb quiet"
GRUB_DISABLE_RECOVERY="true"</pre>
</div>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p8880175812116">Locate parameter <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b15909154382715">GRUB_CMDLINE_LINUX</strong> and add <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b991118437274">crashkernel=auto</strong> after it.</p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li51751194447">Run the following command for the configuration to take effect:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p01738174918"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li51751194447"></a><a name="en-us_topic_0178319250_li51751194447"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b56971122132710"># grub2-mkconfig -o /boot/grub2/grub.cfg</strong></p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li617512910442">Open the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b991831111711">/etc/kdump.conf</strong> file, locate parameter <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b125176201811">path</strong>, and add <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b18580104573114">/var/crash</strong> after it.<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen9560175615302">path  /var/crash</pre>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1648095664910">By default, the file is saved in the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b147741252182">/var/crash</strong> directory. </p>
<div class="p" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p8128115894915">You can save the file to another directory, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b937455310918">/home/kdump</strong>. Then add <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b32521645183217">/home/kdump</strong> after parameter <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1428715519326">path</strong>:<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen85757416315">path  /home/kdump</pre>
</div>
<div class="note" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_note1369322613164"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p36941326171618">There must be enough space in the specified path for storing the vmcore file. It is recommended that the available space be greater than or equal to the RAM size. You can also store the vmcore file on a shared device such as SAN or NFS.</p>
</div></div>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li71761910442">Set the vmcore dump level.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1440772742515"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li71761910442"></a><a name="en-us_topic_0178319250_li71761910442"></a>Add the following content to file <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b101214408189">/etc/kdump.conf</strong>. If the content already exists, skip this step.</p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen1293264111316">core_collector makedumpfile -d 31 -c</pre>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p16451909446">where</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p19921259194218"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b13909155815185">-c</strong> indicates compressing the vmcore file.</p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p9407172712520"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1830142162018">-d</strong> indicates leaving out irrelevant data. Generally, the value following <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b156446563105">-d</strong> is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b63181162111">31</strong>, which is calculated based on the following values. You can adjust the value if needed.</p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen1546919318512">zero pages   = 1
cache pages   = 2
cache private = 4
user  pages   = 8
free  pages   = 16</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li828844335017">Set kernel parameters.<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p2408132792515"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li828844335017"></a><a name="en-us_topic_0178319250_li828844335017"></a>Some kernel parameters control when kdump will be triggered. It is recommended that you set all the parameters as follows:</p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen155819225116">kernel.hardlockup_panic=1
kernel.panic=5
kernel.panic_on_oops=1
kernel.softlockup_panic=1
kernel.unknown_nmi_panic=1
kernel.nmi_watchdog=1</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li204637122512">Modify the preceding parameters in file <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1470941242213">/etc/sysctl.conf</strong> file and save the file. You can also add the following parameters to the <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1685722216229">/etc/sysctl.conf</strong> file:<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen10855122119511">kernel.panic_on_io_nmi=1
kernel.panic_on_warn=1</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li18349164365120">Run the following command to restart the system for the configurations to take effect:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p47991457103213"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li18349164365120"></a><a name="en-us_topic_0178319250_li18349164365120"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b67994573321"># reboot</strong></p>
</li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1296112934412"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_section1296112934412"></a><a name="en-us_topic_0178319250_section1296112934412"></a><h4 class="sectiontitle">Checking Whether kdump Configurations Have Taken Effect</h4><ol id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_ol7179621115215"><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li8167125611819">Run the following command and check whether <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1175013718239">crashkernel=auto</strong> is displayed:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p516611567185"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b184439922019"># </strong><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b137661386202">cat /proc/cmdline |grep crashkernel</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen14166125619182">BOOT_IMAGE=/boot/vmlinuz-3.10.0-514.44.5.10.h142.x86_64 root=UUID=6407d6ac-c761-43cc-a9dd-1383de3fc995 ro crash_kexec_post_notifiers softlockup_panic=1 panic=3 reserve_kbox_mem=16M nmi_watchdog=1 rd.shell=0 fsck.mode=auto fsck.repair=yes net.ifnames=0 spectre_v2=off nopti noibrs noibpb <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b196851156131915">crashkernel=auto</strong> LANG=en_US.UTF-8</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li16935634114418">Run the following command and check whether the values of the parameters in bold are the same as the following:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p516695619181"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li16935634114418"></a><a name="en-us_topic_0178319250_li16935634114418"></a># <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b9166956181816">sysctl -a |grep panic</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen17167115619186"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b18352043153910">kernel.hardlockup_panic = 1</strong>
kernel.hung_task_panic = 0
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b6911050203916">kernel.panic = 5</strong>
kernel.panic_on_io_nmi = 0
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b947115413916">kernel.panic_on_oops = 1</strong>
kernel.panic_on_stackoverflow = 0
kernel.panic_on_unrecovered_nmi = 0
kernel.panic_on_warn = 0
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b46411359203917">kernel.softlockup_panic = 1</strong>
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b3643115912399">kernel.unknown_nmi_panic = 1</strong>
vm.panic_on_oom = 0</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li13493637124416">Run the following command and check whether the configuration in the output is correct:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p12167115691816"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li13493637124416"></a><a name="en-us_topic_0178319250_li13493637124416"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1216765616184"># grep core_collector /etc/kdump.conf |grep -v ^"#"</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen816775621816">core_collector makedumpfile -l --message-level 1 -d 31</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li593014112441">Run the following command and check whether the path configuration in the output is correct:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p1167135681813"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li593014112441"></a><a name="en-us_topic_0178319250_li593014112441"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b61674563187"># grep path /etc/kdump.conf |grep -v ^"#"</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen121671056121811">path /var/crash</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li087484344420">Run the following command and check whether the value of <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b892812744715">Active</strong> in the output is <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b16124101918476">active (exited)</strong>:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p41671356181814"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1116775661814"># systemctl status kdump</strong></p>
<pre class="screen" id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_screen6167115620189">● kdump.service - Crash recovery kernel arming
Loaded: loaded (/usr/lib/systemd/system/kdump.service; enabled; vendor preset: enabled)
<strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b732124274120">Active: active (exited)</strong> since Tue 2019-04-09 19:30:24 CST; 8min ago
Process: 495 ExecStart=/usr/bin/kdumpctl start (code=exited, status=0/SUCCESS)
Main PID: 495 (code=exited, status=0/SUCCESS)
CGroup: /system.slice/system-hostos.slice/kdump.service</pre>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li24721549205215">Run the following test command:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p840962702511"><a name="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li24721549205215"></a><a name="en-us_topic_0178319250_li24721549205215"></a><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b19488101713396"># echo c &gt; /proc/sysrq-trigger</strong></p>
<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p2409132772511">After the command is executed, kdump will be triggered, the system will be restarted, and the generated vmcore file will be saved to the path specified by <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b17837132011262">path</strong>.</p>
</li><li id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_li129451656155213">Run the following command to check whether the vmcore file has been generated in the specified path, for example, <strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b1853513414255">/var/crash/</strong>:<p id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_p194098270251"><strong id="EN-US_TOPIC_0000001143214829__en-us_topic_0178319250_b65418915381"># ll /var/crash/</strong></p>
</li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="en-us_topic_0096170524.html">Troubleshooting</a></div>
</div>
</div>

