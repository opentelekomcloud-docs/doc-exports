<a name="EN-US_TOPIC_0264235942"></a><a name="EN-US_TOPIC_0264235942"></a>

<h1 class="topictitle1">Why Does the System Display Error Code 0x1104 When I Log In to a Windows <span id="text19889162210149">ECS</span>?</h1>
<div id="body8662426"><div class="section" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_section156431143115"><h4 class="sectiontitle">Symptom</h4><p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p196061473112">The system displays an error message indicating that a protocol error (code: 0x1104) is detected when you use MSTSC to access an <span id="EN-US_TOPIC_0264235942__text390252851416">ECS</span> running Windows Server 2008.</p>
<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig7560131184912"><span class="figcap"><b>Figure 1 </b>Protocol error (code: 0x1104)</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image6560171110497" src="en-us_image_0288997598.png" title="Click to enlarge" class="imgResize"></span></div>
</div>
<div class="section" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_section12863194019215"><h4 class="sectiontitle">Possible Causes</h4><ul id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_ul12872132531111"><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li887272514119">Port 3389 of the security group on the ECS is disabled.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li987202517116">The firewall on the ECS is disabled.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li1487222511114">Port 3389 on the ECS is used by other processes.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li98722256114">The Remote Desktop Session Host is incorrectly configured.</li></ul>
</div>
<div class="section" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_section912415446217"><h4 class="sectiontitle">Solution</h4><ol id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_ol9622172741918"><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li5622182711199"><span>Check security group settings.</span><p><p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p1862292711917">Check whether port 3389 is allowed in inbound direction. If it is allowed, go to <a href="#EN-US_TOPIC_0264235942__en-us_topic_0138293293_li18622172719193">2</a>.</p>
</p></li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li18622172719193"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li18622172719193"></a><a name="en-us_topic_0138293293_li18622172719193"></a><span>Check whether the firewall is disabled:</span><p><ol type="a" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_ol1586824010279"><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_li1770284315279">Log in to the Windows <span id="EN-US_TOPIC_0264235942__text16330153761416">ECS</span>.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_li67023437279">Click the Windows icon in the lower left corner of the desktop and choose <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b8125134751913">Control Panel</strong> &gt; <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b1712874711913">Windows Firewall</strong>.<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_p67021443192710"><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_image127023438271" src="en-us_image_0288997600.png" title="Click to enlarge" class="imgResize"></span></p>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_li177027438277">Click <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b1478635811212">Turn Windows Firewall on or off</strong>.<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_p1770284310272">View and set the firewall status.</p>
<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_p13702543162719"><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_en-us_topic_0138887282_image20702104372719" src="en-us_image_0288997602.png" title="Click to enlarge" class="imgResize"></span></p>
</li></ol>
<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p3982089013">If the firewall is enabled, go to <a href="#EN-US_TOPIC_0264235942__en-us_topic_0138293293_li15622182714191">3</a>.</p>
</p></li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li15622182714191"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li15622182714191"></a><a name="en-us_topic_0138293293_li15622182714191"></a><span>Log in to the <span id="EN-US_TOPIC_0264235942__text5735154451419">ECS</span> using VNC and check the port.</span><p><ol type="a" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_ol193148343196"><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li1331443471914">Open the <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b14931104714451">cmd</strong> window and run the following command:<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p126224279197"><strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b262216272193">netstat -ano |findstr: 3389</strong></p>
<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig1562219275192"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig1562219275192"></a><a name="en-us_topic_0138293293_fig1562219275192"></a><span class="figcap"><b>Figure 2 </b>Checking port 3389</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image156221327101918" src="en-us_image_0288997604.png" title="Click to enlarge" class="imgResize"></span></div>
<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p76221627181919">As shown in <a href="#EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig1562219275192">Figure 2</a>, port 3389 is used by the process with ID of 4.</p>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li4703112822211">Open Task Manager and find the process with ID of 4 is the System process.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li4719204611224">Generally, the IIS and SQL Server run as the System process. Run the following HTTP command for further check.<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p61444818228"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li4719204611224"></a><a name="en-us_topic_0138293293_li4719204611224"></a><strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b20253214142319">netsh http show servicestate</strong></p>
<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig16426409265"><span class="figcap"><b>Figure 3 </b>Checking System process</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image691402215919" src="en-us_image_0288997606.png" title="Click to enlarge" class="imgResize"></span></div>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li663413418269">If port 3389 is used by HTTP protocols, it indicates that the port is used by IIS.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li55461830163013">Enter <span class="parmvalue" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_parmvalue1054617300309"><b>http://127.0.0.1:3389</b></span> in the address box of the browser and press <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b97085524515">Enter</strong>. Check whether the website can be visited normally.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li192501653192510">Change the port used by IIS and restart IIS.</li></ol>
</p></li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li9369112211317"><span>If no error occurs during the preceding steps, go to step <a href="#EN-US_TOPIC_0264235942__en-us_topic_0138293293_li19441439143520">5</a> to check whether error 0x1104 is caused by the configuration of Remote Desktop Session Host.</span></li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li19441439143520"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li19441439143520"></a><a name="en-us_topic_0138293293_li19441439143520"></a><span>Check the remote desktop session host configuration.</span><p><ol type="a" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_ol017724312358"><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li084995216356">Log in to the <span id="EN-US_TOPIC_0264235942__text11482185361412">ECS</span> using VNC.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li168881270360">Open the <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b15652181112115">cmd</strong> window and enter <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b56601711172118">gpedit.msc</strong>.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li1296751133712">Click <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b187540392245">OK</strong> to start Local Group Policy Editor.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li1360819716361">Choose <strong id="EN-US_TOPIC_0264235942__b15431331171812">Computer Configuration</strong> &gt; <strong id="EN-US_TOPIC_0264235942__b14441831111811">Administrative Templates</strong> &gt; <strong id="EN-US_TOPIC_0264235942__b124412311182">Windows Components</strong> &gt; <strong id="EN-US_TOPIC_0264235942__b1244193114187">Remote Desktop Services</strong>.<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig1072317112254"><span class="figcap"><b>Figure 4 </b>Remote Desktop Services</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image6882162518389" src="en-us_image_0288997608.png" title="Click to enlarge" class="imgResize"></span></div>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li54331810402"><strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b2583565135">Remote Desktop Session Host</strong> &gt; <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b116395615134">Security</strong>.<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig64299268259"><span class="figcap"><b>Figure 5 </b>Remote (RDP) Connection requires the use of the specified security layer</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image1999719116410" src="en-us_image_0288997610.png" title="Click to enlarge" class="imgResize"></span></div>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li2483154434019">Set <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b1867618372143">Require use of specific security layer for remote (RDP) connections</strong> to <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b768214373147">Enabled</strong> and <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b168263781413">Security layer</strong> to <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b168213761412">RDP</strong>.<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig6816237202719"><span class="figcap"><b>Figure 6 </b>Setting security layer</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image11978156174116" src="en-us_image_0288997612.png" title="Click to enlarge" class="imgResize"></span></div>
</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li690412409387">Click <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b10611101484920">OK</strong>.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li1478722820428">After the configuration is complete, open the <strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b58316185138">cmd</strong> window.</li><li id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li5589553104211">Run the following command to update the group policy:<p id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_p171441718164317"><a name="EN-US_TOPIC_0264235942__en-us_topic_0138293293_li5589553104211"></a><a name="en-us_topic_0138293293_li5589553104211"></a><strong id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_b45931020174318">gpupdate</strong></p>
<div class="fignone" id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_fig1129272819299"><span class="figcap"><b>Figure 7 </b>Updating the group policy</span><br><span><img id="EN-US_TOPIC_0264235942__en-us_topic_0138293293_image114091432184317" src="en-us_image_0288997614.png" title="Click to enlarge" class="imgResize"></span></div>
</li></ol>
</p></li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="en-us_topic_0030930807.html">Login and Connection</a></div>
</div>
</div>


<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script>