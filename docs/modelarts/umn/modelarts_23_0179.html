<a name="modelarts_23_0179"></a><a name="modelarts_23_0179"></a>

<h1 class="topictitle1">Scikit Learn</h1>
<div id="body8662426"><div class="section" id="modelarts_23_0179__en-us_topic_0196941735_section1962751053415"><h4 class="sectiontitle">Training and Saving a Model</h4><pre class="screen" id="modelarts_23_0179__screen75332147207">import json
import pandas as pd
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.externals import joblib
iris = pd.read_csv('/home/ma-user/work/iris.csv')
X = iris.drop(['variety'],axis=1)
y = iris[['variety']]
# Create a LogisticRegression instance and train model
logisticRegression = LogisticRegression(C=1000.0, random_state=0)
logisticRegression.fit(X,y)
# Save model to local path
joblib.dump(logisticRegression, '/tmp/sklearn.m')</pre>
<p id="modelarts_23_0179__p1296192155020">Before training, download the <strong id="modelarts_23_0179__b27415557085931">iris.csv</strong> dataset, decompress it, and upload it to the <strong id="modelarts_23_0179__b118904573285931">/home/ma-user/work/</strong> directory of the notebook instance. Download the <strong id="modelarts_23_0179__b148777756685913">iris.csv</strong> dataset from <a href="https://gist.github.com/netj/8836201" target="_blank" rel="noopener noreferrer">https://gist.github.com/netj/8836201</a>. </p>
<p id="modelarts_23_0179__p19585394911">After the model is saved, it must be uploaded to the OBS directory before being published. The <strong id="modelarts_23_0179__b129419124710">config.json</strong> and <strong id="modelarts_23_0179__b109971154719">customize_service.py</strong> files must be contained during publishing. For details about the definition method, see <a href="modelarts_23_0091.html">Model Package Specifications</a>.</p>
</div>
<div class="section" id="modelarts_23_0179__en-us_topic_0196941735_section6122193511917"><h4 class="sectiontitle">Inference Code</h4><pre class="screen" id="modelarts_23_0179__screen18549326142016"># coding:utf-8
import collections
import json
from sklearn.externals import joblib
from model_service.python_model_service import XgSklServingBaseService

class user_Service(XgSklServingBaseService):

    # request data preprocess
    def _preprocess(self, data):
        list_data = []
        json_data = json.loads(data, object_pairs_hook=collections.OrderedDict)
        for element in json_data["data"]["req_data"]:
            array = []
            for each in element:
                array.append(element[each])
                list_data.append(array)
        return list_data

    # predict
    def _inference(self, data):
        sk_model = joblib.load(self.model_path)
        pre_result = sk_model.predict(data)
        pre_result = pre_result.tolist()
        return pre_result

    # predict result process
    def _postprocess(self,data):
        resp_data = []
        for element in data:
            resp_data.append({"predictresult": element})
        return resp_data</pre>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="modelarts_23_0172.html">Examples of Custom Scripts</a></div>
</div>
</div>

